<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>World Bank Gender Data Portal | Assets | World Bank Gender Data Portal</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/xlsx.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.15/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/exceljs@4.4.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/Assets.csv", {"name":"./data/Assets.csv","mimeType":"text/csv","path":"./_file/data/Assets.76cf0048.csv","lastModified":1678967984831});
registerFile("./data/CLASS.xlsx", {"name":"./data/CLASS.xlsx","mimeType":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","path":"./_file/data/CLASS.6ec0faa0.xlsx","lastModified":1679051111158});
registerFile("./data/marriage_grants_equal_authority.png", {"name":"./data/marriage_grants_equal_authority.png","mimeType":"image/png","path":"./_file/data/marriage_grants_equal_authority.24ef0076.png","lastModified":1686350470007});
registerFile("./data/mobile_money_account_by_sex.png", {"name":"./data/mobile_money_account_by_sex.png","mimeType":"image/png","path":"./_file/data/mobile_money_account_by_sex.8ffa8a7c.png","lastModified":1686350469940});
registerFile("./data/own_house_or_land_by_sex.png", {"name":"./data/own_house_or_land_by_sex.png","mimeType":"image/png","path":"./_file/data/own_house_or_land_by_sex.f0bbe564.png","lastModified":1686350470127});
registerFile("./data/saved_money_last_year_by_sex.png", {"name":"./data/saved_money_last_year_by_sex.png","mimeType":"image/png","path":"./_file/data/saved_money_last_year_by_sex.3bffb62e.png","lastModified":1686350469446});

define({id: "24a81051", body: () => {
// toc("h2, h3")
}});

define({id: "f7efae95", body: () => {
// This is a little helper function used to generate the Table of Contents
//import {toc} from '@categorise/toc'
}});

define({id: "eb4a73b9", inputs: ["display","FileAttachment"], outputs: ["assets"], body: async (display,FileAttachment) => {
const assets = display(await FileAttachment("./data/Assets.csv").csv({typed: true}))
return {assets};
}});

define({id: "a02c80e6", inputs: ["view","Inputs","assets"], body: (view,Inputs,assets) => {
view(Inputs.table(assets))
}});

define({id: "7f120d88", mode: "inline", inputs: ["assets","display"], body: async (assets,display) => {
display(await(
[...new Set(assets.flatMap(obj => Object.keys(obj)))].length
))
}});

define({id: "de272d84", mode: "inline", inputs: ["assets","html","display"], body: async (assets,html,display) => {
display(await(
Object.keys(assets[0]).sort().map(key => html`<li>${key}`)
))
}});

define({id: "aedcbc08", mode: "inline", inputs: ["year_group","display"], body: async (year_group,display) => {
display(await(
year_group.length
))
}});

define({id: "ce5734a4", inputs: ["display","d3","assets"], outputs: ["year_group"], body: (display,d3,assets) => {
const year_group = display([... new Set(d3.flatGroup(assets, d => d["Year"]))])
return {year_group};
}});

define({id: "e3846d90", mode: "inline", inputs: ["countries_group","display"], body: async (countries_group,display) => {
display(await(
countries_group.length
))
}});

define({id: "3991cd80", inputs: ["display","d3","assets"], outputs: ["countries_group"], body: (display,d3,assets) => {
const countries_group = display(d3.flatGroup(assets, d => d["Country Name"]))
return {countries_group};
}});

define({id: "e3846d90-1", mode: "inline", inputs: ["countries_group","display"], body: async (countries_group,display) => {
display(await(
countries_group.length
))
}});

define({id: "32352be5", mode: "inline", inputs: ["indicators_group","display"], body: async (indicators_group,display) => {
display(await(
indicators_group.length
))
}});

define({id: "b180f547", inputs: ["display","d3","assets"], outputs: ["indicators_group"], body: (display,d3,assets) => {
const indicators_group = display([... new Set(d3.flatGroup(assets, d => d["Indicator Name"]))])
return {indicators_group};
}});

define({id: "5aff952e", inputs: ["d3","assets"], outputs: ["indicators_group_year"], body: (d3,assets) => {
const indicators_group_year = [... new Set(d3.flatGroup(assets, d => d["Indicator Name"], d => d["Year"]))]
return {indicators_group_year};
}});

define({id: "d27ad9b3", inputs: ["display","indicators_group_year"], outputs: ["indicators_group_year_max"], body: (display,indicators_group_year) => {
const indicators_group_year_max = display((() => {
let maxObservations = 0;
let indicatorWithMostObservations;

for (const entry of indicators_group_year) {
  const observations = entry[2].length;
  if (observations > maxObservations) {
    maxObservations = observations;
    indicatorWithMostObservations = entry[0];
  }
}

return {
  "Indicator with the most observations in a single year": indicatorWithMostObservations,
  "Greatest number of observations in a single year": maxObservations
}
})())
return {indicators_group_year_max};
}});

define({id: "7280c7f4", inputs: ["display","indicators_group_year"], outputs: ["indicators_group_year_min"], body: (display,indicators_group_year) => {
const indicators_group_year_min = display((() => {
let minObservations = Infinity;
let indicatorWithFewestObservations;

for (const entry of indicators_group_year) {
  const observations = entry[2].length;
  if (observations < minObservations) {
    minObservations = observations;
    indicatorWithFewestObservations = entry[0];
  }
}

return {
  "Indicator with the fewest observations in a single year": indicatorWithFewestObservations,
  "Least number of observations in a single year (>0)": minObservations
};
})())
return {indicators_group_year_min};
}});

define({id: "75f21ab6", inputs: ["d3","assets"], outputs: ["indicators_group_year_country"], body: (d3,assets) => {
const indicators_group_year_country =  [... new Set(d3.flatGroup(assets, d => d["Indicator Name"], d => d["Country Name"]))]
return {indicators_group_year_country};
}});

define({id: "56bd7279", inputs: ["display","indicators_group_year_country"], outputs: ["indicators_group_year_country_max"], body: (display,indicators_group_year_country) => {
const indicators_group_year_country_max = display((() => {
let maxObservations = 0;
let indicatorWithMostObservations;

for (const entry of indicators_group_year_country) {
  const observations = entry[2].length;
  if (observations > maxObservations) {
    maxObservations = observations;
    indicatorWithMostObservations = entry[0];
  }
}

return {
  "Indicator with the most observations for a single country or region": indicatorWithMostObservations,
  "Greatest number of observations for a single country or region": maxObservations
}
})())
return {indicators_group_year_country_max};
}});

define({id: "75d5b078", inputs: ["display","indicators_group_year_country"], outputs: ["indicators_group_year_country_min"], body: (display,indicators_group_year_country) => {
const indicators_group_year_country_min = display((() => {
let minObservations = Infinity;
let indicatorWithFewestObservations;

for (const entry of indicators_group_year_country) {
  const observations = entry[2].length;
  if (observations < minObservations) {
    minObservations = observations;
    indicatorWithFewestObservations = entry[0];
  }
}

return {
  "Indicator with the fewest observations for a single country or region": indicatorWithFewestObservations,
  "Least number of observations for a single country or region": minObservations
};
})())
return {indicators_group_year_country_min};
}});

define({id: "a26f89d7", inputs: ["FileAttachment"], outputs: ["mobile_money_account_by_sex"], body: async (FileAttachment) => {
const mobile_money_account_by_sex = await FileAttachment("./data/mobile_money_account_by_sex.png").image()
return {mobile_money_account_by_sex};
}});

define({id: "638b98a0", inputs: ["FileAttachment","display"], body: async (FileAttachment,display) => {
display(await(
(await FileAttachment("./data/mobile_money_account_by_sex.png")).image()
))
}});

define({id: "0dab33d8", inputs: ["display","assets"], outputs: ["aggregated_economies"], body: (display,assets) => {
const aggregated_economies = display(assets.filter(asset => [
  'High income',
  'Upper middle income',
  'Lower middle income',
  'Low income'
].includes(asset['Country Name'])))
return {aggregated_economies};
}});

define({id: "1f1ab114", inputs: ["assets"], outputs: ["aggregated_account_ownership"], body: (assets) => {
const aggregated_account_ownership = assets.filter(asset => {
  const countryNameMatch = [
  'High income',
  'Upper middle income',
  'Lower middle income',
  'Low income'
]
    // This bit refines our search for specfic indicators
  .includes(asset['Country Name']);
  const indicatorCodeMatch = [
  'FX.OWN.TOTL.FE.ZS',
  'FX.OWN.TOTL.MA.ZS'
].includes(asset['Indicator Code']);
  return countryNameMatch && indicatorCodeMatch;
})
    // This bit adds an additional column as a helper, called 'Sex' (for lack of a better word)
    // We use it because it can be dizzying to look at just the indicator codes.
  .map(asset => {
  const Sex = asset['Indicator Code'] === 'FX.OWN.TOTL.FE.ZS' ? 'Female' : 'Male';
  return { Sex, ...asset };
})
return {aggregated_account_ownership};
}});

define({id: "a98fb9a9", inputs: ["view","Inputs","aggregated_account_ownership"], body: (view,Inputs,aggregated_account_ownership) => {
view(Inputs.table(aggregated_account_ownership))
}});

define({id: "10f6daa6", inputs: ["Plot","width","aggregated_account_ownership","display"], body: async (Plot,width,aggregated_account_ownership,display) => {
display(await(
Plot.plot({
  marginLeft: 150,
  width,
  color: { range: ["orange", "purple"] },
  fx: { tickFormat: "d" },
  x: { domain: [0, 100], ticks: 5 },
  fy: {domain:  ["Low income","Lower middle income", "Upper middle income", "High income"] },
  marks: [
    Plot.frame(),
    Plot.ruleY(
      aggregated_account_ownership,
      Plot.groupZ(
        { x1: "min", x2: "max" },
        { x1: "Value", x2: "Value", y: null, fx: "Year", fy: "Country Name" }
      )
    ),
    Plot.dotX(
      aggregated_account_ownership,
      Plot.groupX(
        { x: "mean" },
        { x: "Value", fill: "Sex", r: 5, fx: "Year", fy: "Country Name", tip: true, }
      )
    )
  ]
})
))
}});

define({id: "d33b55e7", inputs: ["html","Plot","width","aggregated_account_ownership","display"], body: async (html,Plot,width,aggregated_account_ownership,display) => {
display(await(
html.fragment`<span style="font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1;">
    Account ownership at a financial institution</br>
    or with a mobile-money-service provider</br>
    by sex and income group
</span>
${Plot.plot({
  marginLeft: 150,
  width: width*0.9,
  height: width*0.4,
  color: { range: ["orange", "purple"], legend: true },
  fx: { tickFormat: "d" },
  x: { domain: [0, 100], ticks: 5 },
  fy: {domain:  ["Low income","Lower middle income", "Upper middle income", "High income"] },
  marks: [
    Plot.frame({ strokeOpacity: 0.2 }),
    Plot.ruleY(
      aggregated_account_ownership.filter(d => d.Year === 2017),
      Plot.groupZ(
        { x1: "min", x2: "max" },
        { x1: "Value", x2: "Value", y: null, fx: "Year", fy: "Country Name" }
      )
    ),
    Plot.dotX(
      aggregated_account_ownership.filter(d => d.Year === 2017),
      Plot.groupX(
        { x: "mean" },
        { x: "Value", fill: "Sex", r: 9, fx: "Year", fy: "Country Name", tip: {
              format: {
                Sex: true,
                Value: true,
                fx: false,
                fy: true,
              }
            }, }
      )
    )
  ]
})}
<br/>
<span style="font-family: Andes, Arial, sans-serif;">
    <sub>Source: <a href="https://genderdata.worldbank.org/topics/assets">World Bank</a></sub>
</span>`
))
}});

define({id: "06290dc8", inputs: ["FileAttachment"], outputs: ["saved_money_last_year_by_sex"], body: async (FileAttachment) => {
const saved_money_last_year_by_sex = await FileAttachment("./data/saved_money_last_year_by_sex.png").image()
return {saved_money_last_year_by_sex};
}});

define({id: "50f77ef9", inputs: ["FileAttachment","display"], body: async (FileAttachment,display) => {
display(await(
(await FileAttachment("./data/saved_money_last_year_by_sex.png")).image()
))
}});

define({id: "b361b205", inputs: ["assets"], outputs: ["aggregated_money_savings_last_year"], body: (assets) => {
const aggregated_money_savings_last_year = assets.filter(asset => {
  const countryNameMatch = [
  'High income',
  'Upper middle income',
  'Lower middle income',
  'Low income'
]
    // This bit refines our search for specfic indicators
  .includes(asset['Country Name']);
  const indicatorCodeMatch = [
  'fin18.t.d.1',
  'fin18.t.d.2'
].includes(asset['Indicator Code']);
  return countryNameMatch && indicatorCodeMatch;
})
    // This bit adds an additional column as a helper, called 'Sex' (for lack of a better word)
    // We use it because it can be dizzying to look at just the indicator codes.
  .map(asset => {
  const Sex = asset['Indicator Code'] === 'fin18.t.d.2' ? 'Female' : 'Male';
  return { Sex, ...asset };
})
return {aggregated_money_savings_last_year};
}});

define({id: "2349f2e7", inputs: ["view","Inputs","aggregated_money_savings_last_year"], body: (view,Inputs,aggregated_money_savings_last_year) => {
view(Inputs.table(aggregated_money_savings_last_year))
}});

define({id: "7f7ddce9", inputs: ["Plot","width","aggregated_money_savings_last_year","display"], body: async (Plot,width,aggregated_money_savings_last_year,display) => {
display(await(
Plot.plot({
  marginLeft: 150,
  width: width*0.9,
  height: 300,
  color: { range: ["orange", "purple", "#ccc"], legend: true,  },
  y: {domain:  ["Low income","Lower middle income", "Upper middle income", "High income"] },
  marks: [
    Plot.frame({ strokeOpacity: 0.2 }),
    Plot.barX(aggregated_money_savings_last_year, {
      fy: "Year",
      x1: "Value",
      sort: "Value", reverse: true,
      y: "Country Name",
      fill: "Sex",
      tip: {
              format: {
                Sex: true,
                Value: true,
                y: false,
                x2: false,
                fy: false,
              }
            },
    }),
    Plot.ruleX([0])
  ]
})
))
}});

define({id: "03d1ac18", inputs: ["aggregated_money_savings_last_year"], outputs: ["aggregated_money_savings_last_year_2017"], body: (aggregated_money_savings_last_year) => {
const aggregated_money_savings_last_year_2017 = aggregated_money_savings_last_year.filter(d => d.Year === 2017);
return {aggregated_money_savings_last_year_2017};
}});

define({id: "5fecd49b", inputs: ["html","Plot","aggregated_money_savings_last_year_2017","display"], body: async (html,Plot,aggregated_money_savings_last_year_2017,display) => {
display(await(
html.fragment`<table>
  <tr>
   <td>
    <br/>
    <br/>
    <br/>
    <br/>
     <span style="font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1; padding-right:40px;">
    Saved any money <br/>in the past year <sub>(2017)</sub>
</span>
<br/>
<span style="font-family: Andes, Arial, sans-serif;">
    <sub>Source: <a href="https://genderdata.worldbank.org/topics/assets">World Bank</a></sub>
</span>
    </td>
        <td>
${Plot.plot({
  marginLeft: 0,
  marginTop: 20,
  height: 140,
  width: 500,
  color: { range: ["orange", "purple"], legend: true },
  facet: {
    data: aggregated_money_savings_last_year_2017,
    x: (d) => !["Low income", "Upper middle income"].includes(d["Country Name"]),
    y: (d) => !["Low income", "Lower middle income"].includes(d["Country Name"])
  },
  x: {axis: null, domain: [0, 100]},
  y: {axis: null},
  fx: {axis: null},
  fy: {axis: null, paddingInner: 0.4},
  marks: [
    //Plot.frame(),
    Plot.text(aggregated_money_savings_last_year_2017, Plot.selectFirst({
      frameAnchor: "top-left",
      text: "Country Name",
      lineAnchor: "bottom",
      fontSize: 14,
      fontWeight: "bold",
      dy: -5
    })),
    Plot.rectX(aggregated_money_savings_last_year_2017, {
      fill: "Sex",
      reverse: true,
      y1: d => d.Sex === "Male" ? 1.5 : 0,
      y2: d => d.Sex === "Male" ? 4 : 2.5,
      x2: "Value",
      tip:{
              format: {
                Sex: true,
                Value: true,
                x1: false,
                y: false,
                fx: false,
                fy: false,
              }
            },
    }),
    Plot.textX(aggregated_money_savings_last_year_2017, {
      fill: "Sex",
      filter: (d) => d.Sex === "Female",
      text: d => `${d.Value.toFixed(1)}%`,
      textAnchor: "start",
      fontSize: 14,    
      insetTop: 10,
      dx: 4,
      frameAnchor: "bottom",
      fontWeight: "bold",
      x: "Value"
    }),
    Plot.textX(aggregated_money_savings_last_year_2017, {
      fill: "Sex",
      filter: (d) => d.Sex === "Male",
      text: d => `${d.Value.toFixed(1)}%`,
      textAnchor: "start",
      fontSize: 14,
      insetTop: 10,
      frameAnchor: "top",
      fontWeight: "bold",
      dx: 4,
      x: "Value"
    })
  ]
})}
      </td>
      </tr>
</table>`
))
}});

define({id: "37487953", inputs: ["FileAttachment"], outputs: ["own_house_or_land_by_sex"], body: async (FileAttachment) => {
const own_house_or_land_by_sex = await FileAttachment("./data/own_house_or_land_by_sex.png").image()
return {own_house_or_land_by_sex};
}});

define({id: "a581caa2", inputs: ["FileAttachment","display"], body: async (FileAttachment,display) => {
display(await(
(await FileAttachment("./data/own_house_or_land_by_sex.png")).image()
))
}});

define({id: "a38f7cc0", inputs: ["display","FileAttachment"], outputs: ["country_and_lending_group_classifications"], body: async (display,FileAttachment) => {
const country_and_lending_group_classifications = display(await FileAttachment("./data/CLASS.xlsx").xlsx().then(d => d.sheet("List of economies", {headers: true})))
return {country_and_lending_group_classifications};
}});

define({id: "97faa437", inputs: ["display","country_and_lending_group_classifications"], outputs: ["regions"], body: (display,country_and_lending_group_classifications) => {
const regions = display(Array.from(new Set(country_and_lending_group_classifications.map(d => d["Region"]))).filter(function( element ) {
   return element !== undefined;
}))
return {regions};
}});

define({id: "686817ae", inputs: ["display","country_and_lending_group_classifications","regions"], outputs: ["country_and_lending_group_classification_economies"], body: (display,country_and_lending_group_classifications,regions) => {
const country_and_lending_group_classification_economies = display(country_and_lending_group_classifications.filter(({ Region }) => regions.includes(Region)).flatMap(({ Economy }) => Economy))
return {country_and_lending_group_classification_economies};
}});

define({id: "21c61865", mode: "inline", inputs: ["country_and_lending_group_classification_economies","display"], body: async (country_and_lending_group_classification_economies,display) => {
display(await(
country_and_lending_group_classification_economies.length
))
}});

define({id: "be498988", mode: "inline", inputs: ["country_and_lending_group_classification_economies","countries_group","display"], body: async (country_and_lending_group_classification_economies,countries_group,display) => {
display(await(
country_and_lending_group_classification_economies.length - countries_group.length
))
}});

define({id: "ed513226", outputs: ["compare_country_datasets"], body: () => {
function compare_country_datasets(source, comparison) {
  const common_countries = Array.from(source).filter(country => comparison.has(country));
  const source_countries = Array.from(source).filter(country => !comparison.has(country));
  const comparison_countries = Array.from(comparison).filter(country => !source.has(country));

  return {common_values: common_countries, source_unique: source_countries, comparison_unique: comparison_countries};
}
return {compare_country_datasets};
}});

define({id: "3354aca3", inputs: ["display","compare_country_datasets","countries_group","country_and_lending_group_classification_economies"], outputs: ["country_datasets_comparison"], body: (display,compare_country_datasets,countries_group,country_and_lending_group_classification_economies) => {
const country_datasets_comparison = display(compare_country_datasets(new Set(countries_group.map(d => d[0])), new Set(country_and_lending_group_classification_economies)))
return {country_datasets_comparison};
}});

define({id: "a7d00bba", inputs: ["country_and_lending_group_classifications"], outputs: ["economies_renamed"], body: (country_and_lending_group_classifications) => {
const economies_renamed = country_and_lending_group_classifications.map(c => ({ ...c, Economy: { "Côte d’Ivoire": "Cote d'Ivoire", "Czech Republic": "Czechia", "São Tomé and Príncipe": "Sao Tome and Principe", "Türkiye": "Turkiye" }[c.Economy] || c.Economy }));
return {economies_renamed};
}});

define({id: "3cd66100", inputs: ["assets","economies_renamed"], outputs: ["own_house"], body: (assets,economies_renamed) => {
const own_house = assets.filter(asset => {
  const countryNameMatch = economies_renamed.some(entry =>
    entry.Economy === asset['Country Name']
  );

  const indicatorCodeMatch = [
    'SG.OWN.HSAL.FE.ZS',
    'SG.OWN.HSAL.MA.ZS',
    'SG.OWN.HSJT.FE.ZS',
    'SG.OWN.HSJT.MA.ZS',
    'SG.OWN.HSAJ.FE.ZS',
    'SG.OWN.HSAJ.MA.ZS',
  ].includes(asset['Indicator Code']);

  return countryNameMatch && indicatorCodeMatch;
})
  .map(asset => {
    const isFemaleIndicator = [
      'SG.OWN.HSAL.FE.ZS',
      'SG.OWN.HSJT.FE.ZS',
      'SG.OWN.HSAJ.FE.ZS'
    ].includes(asset['Indicator Code']);

    const Sex = isFemaleIndicator ? 'Female' : 'Male';

    const classification = economies_renamed.find(c =>
      c.Economy === asset['Country Name']
    );

    if (classification) {
      return {
        ...asset,
        Region: classification.Region,
        'Income group': classification['Income group'],
        Sex
      };
    }

    return { ...asset, Sex };
});
return {own_house};
}});

define({id: "77c86001", inputs: ["view","Inputs","own_house"], body: (view,Inputs,own_house) => {
view(Inputs.table(own_house ))
}});

define({id: "f00f9c38", inputs: ["own_house"], outputs: ["own_house_filtered"], body: (own_house) => {
const own_house_filtered = Object.values(
  Object.values(
    //Reduce the 'own_house' array to a key-value store with unique keys based on specific properties.
    own_house.reduce((r, c) => {
      // Create a unique key based on specific properties of the object.
      const key = JSON.stringify({
        "Country Name": c["Country Name"],
        "Country Code": c["Country Code"],
        "Year": c["Year"],
        "Region": c["Region"],
        "Income group": c["Income group"],
      });
      // If the key does not exist in the result object, initialize it with specific properties and default values.
      r[key] = r[key] || { ...c, "Female Value": 0, "Male Value": 0, "Indicator Name": "Own House" };
      // Check if the current entry corresponds to Female or Male Value indicator and update values accordingly.
      const isFemaleIndicator = ["SG.OWN.HSAL.FE.ZS", "SG.OWN.HSJT.FE.ZS", "SG.OWN.HSAJ.FE.ZS"].includes(c["Indicator Code"]);
      const isMaleIndicator = ["SG.OWN.HSAL.MA.ZS", "SG.OWN.HSJT.MA.ZS", "SG.OWN.HSAJ.MA.ZS"].includes(c["Indicator Code"]);
      // Update Female and Male Values based on the indicator type.
      r[key]["Female Value"] += isFemaleIndicator ? (isNaN(c["Value"]) ? 0 : c["Value"]) : 0;
      r[key]["Male Value"] += isMaleIndicator ? (isNaN(c["Value"]) ? 0 : c["Value"]) : 0;

      return r;
    }, {})
    // Group the transformed data by unique keys (Country Name and Indicator Code)
  ).reduce((groups, entry) => {
    const key = `${entry["Country Name"]}-${entry["Indicator Code"]}`;
    // If the key does not exist in the groups object, initialize it as an empty array.
    groups[key] = groups[key] || [];
    // Push the current entry into the corresponding group.
    groups[key].push(entry);
    return groups;
  }, {})
  //Extract the most recent data for Female and Male Values, filling missing Male Values with the last available value.
).flatMap(group => {
  // Find the most recent year in the current group.
  const mostRecentYear = Math.max(...group.map(entry => entry["Year"]));
  let lastMaleValue = null;
  
  return group
    // Filter the entries for the most recent year and non-zero Female and Male Values.
    .filter(entry => entry["Year"] === mostRecentYear && entry["Male Value"] !== 0 && entry["Female Value"] !== 0)
    .map(entry => {
      // Fill missing Male Values with the last available value.
      if (entry["Male Value"] === 0 && lastMaleValue !== null) {
        entry["Male Value"] = lastMaleValue;
      } else {
        lastMaleValue = entry["Male Value"];
      }
      return entry;
    });
})
return {own_house_filtered};
}});

define({id: "f0c643a4", inputs: ["Plot","own_house_filtered","display"], body: async (Plot,own_house_filtered,display) => {
display(await(
Plot.plot({
  color: { legend: true, range: ["dodgerblue", "magenta", "green", "purple" , "orange", "red", "gray"], opacity : 0.8 },
  insetTop: 10,
  insetRight: 10,
  insetBottom: 10,
  insetLeft: 10,
  height: 400,
  width: 500,
  y: { percent: false,domain:[0,100], grid: true },
  x: { percent: false, domain:[0,100], grid: true },
  caption: "Own House",
  marks: [
    Plot.dot(own_house_filtered, {
      x: "Male Value",
      y: "Female Value",
      stroke: "Region",
      fill: "Region",
      opacity: 0.4,
      channels: {Year: "Year", Country: "Country Name"},
      tip: true
    }),
    Plot.ruleX([0]),
    Plot.ruleY([0]),
    Plot.link([0], {
      x1: 0,
      y1: 0,
      x2: 100,
      y2: 100,
      strokeDasharray: "5,3",
      strokeOpacity: (k) => k === 1 ? 1 : 0.2
    }),
  ],
})
))
}});

define({id: "fe4e9792", inputs: ["assets","economies_renamed"], outputs: ["own_land"], body: (assets,economies_renamed) => {
const own_land = assets.filter(asset => {
  const countryNameMatch = economies_renamed.some(entry =>
    entry.Economy === asset['Country Name']
  );

  const indicatorCodeMatch = [
    // own land alone
    'SG.OWN.LDAL.FE.ZS',
    'SG.OWN.LDAL.MA.ZS',
    // own land jointly
    'SG.OWN.LDJT.FE.ZS',
    'SG.OWN.LDJT.MA.ZS',
    // own land both alone and jointly
    'SG.OWN.LDAJ.FE.ZS',
    'SG.OWN.LDAJ.MA.ZS',
  ].includes(asset['Indicator Code']);

  return countryNameMatch && indicatorCodeMatch;
})
  .map(asset => {
    const isFemaleIndicator = [
      'SG.OWN.LDAL.FE.ZS',
      'SG.OWN.LDJT.FE.ZS',
      'SG.OWN.LDAJ.FE.ZS'
    ].includes(asset['Indicator Code']);

    const Sex = isFemaleIndicator ? 'Female' : 'Male';

    const classification = economies_renamed.find(c =>
      c.Economy === asset['Country Name']
    );

    if (classification) {
      return {
        ...asset,
        Region: classification.Region,
        'Income group': classification['Income group'],
        Sex
      };
    }

    return { ...asset, Sex };
});
return {own_land};
}});

define({id: "2d5e1a96", inputs: ["own_land"], outputs: ["own_land_filtered"], body: (own_land) => {
const own_land_filtered = Object.values(
  Object.values(
    //Reduce the 'own_land' array to a key-value store with unique keys based on specific properties.
    own_land.reduce((r, c) => {
      // Create a unique key based on specific properties of the object.
      const key = JSON.stringify({
        "Country Name": c["Country Name"],
        "Country Code": c["Country Code"],
        "Year": c["Year"],
        "Region": c["Region"],
        "Income group": c["Income group"],
      });
      // If the key does not exist in the result object, initialize it with specific properties and default values.
      r[key] = r[key] || { ...c, "Female Value": 0, "Male Value": 0, "Indicator Name": "Own Land" };
      // Check if the current entry corresponds to Female or Male Value indicator and update values accordingly.
      const isFemaleIndicator = [
    // own land alone
    'SG.OWN.LDAL.FE.ZS',
    // own land jointly
    'SG.OWN.LDJT.FE.ZS',
    // own land both alone and jointly
    'SG.OWN.LDAJ.FE.ZS'].includes(c["Indicator Code"]);
      const isMaleIndicator = [
    // own land alone
    'SG.OWN.LDAL.MA.ZS',
    // own land jointly
    'SG.OWN.LDJT.MA.ZS',
    // own land both alone and jointly,
    'SG.OWN.LDAJ.MA.ZS'].includes(c["Indicator Code"]);
      // Update Female and Male Values based on the indicator type.
      r[key]["Female Value"] += isFemaleIndicator ? (isNaN(c["Value"]) ? 0 : c["Value"]) : 0;
      r[key]["Male Value"] += isMaleIndicator ? (isNaN(c["Value"]) ? 0 : c["Value"]) : 0;

      return r;
    }, {})
    // Group the transformed data by unique keys (Country Name and Indicator Code)
  ).reduce((groups, entry) => {
    const key = `${entry["Country Name"]}-${entry["Indicator Code"]}`;
    // If the key does not exist in the groups object, initialize it as an empty array.
    groups[key] = groups[key] || [];
    // Push the current entry into the corresponding group.
    groups[key].push(entry);
    return groups;
  }, {})
  //Extract the most recent data for Female and Male Values, filling missing Male Values with the last available value.
).flatMap(group => {
  // Find the most recent year in the current group.
  const mostRecentYear = Math.max(...group.map(entry => entry["Year"]));
  let lastMaleValue = null;
  
  return group
    // Filter the entries for the most recent year and non-zero Female and Male Values.
    .filter(entry => entry["Year"] === mostRecentYear && entry["Male Value"] !== 0 && entry["Female Value"] !== 0)
    .map(entry => {
      // Fill missing Male Values with the last available value.
      if (entry["Male Value"] === 0 && lastMaleValue !== null) {
        entry["Male Value"] = lastMaleValue;
      } else {
        lastMaleValue = entry["Male Value"];
      }
      return entry;
    });
})
return {own_land_filtered};
}});

define({id: "9a624d8a", inputs: ["Plot","own_land_filtered","display"], body: async (Plot,own_land_filtered,display) => {
display(await(
Plot.plot({
  color: { legend: true, range: ["dodgerblue", "magenta", "green", "purple" , "orange", "red", "gray"], opacity : 0.8 },
  insetTop: 10,
  insetRight: 10,
  insetBottom: 10,
  insetLeft: 10,
  height: 400,
  width: 500,
  y: { percent: false,domain:[0,80], grid: true },
  x: { percent: false, domain:[0,80], grid: true },
  caption: "Own Land",
  marks: [
    Plot.dot(own_land_filtered, {
      x: "Male Value",
      y: "Female Value",
      stroke: "Region",
      fill: "Region",
      opacity: 0.4,
      channels: {Year: "Year", Country: "Country Name"},
      tip: true
    }),
    Plot.ruleX([0]),
    Plot.ruleY([0]),
    Plot.link([0], {
      x1: 0,
      y1: 0,
      x2: 100,
      y2: 100,
      strokeDasharray: "5,3",
      strokeOpacity: (k) => k === 1 ? 1 : 0.2
    }),
  ],
})
))
}});

define({id: "b3635098", outputs: ["categories"], body: () => {
const categories = [
            "Latin America & Caribbean",
            "South Asia",     
            "Sub-Saharan Africa",
            "Europe & Central Asia",
            "Middle East & North Africa",
            "East Asia & Pacific",
]
return {categories};
}});

define({id: "c85d582b", outputs: ["categoricalRange"], body: () => {
const categoricalRange = [
 "rgba(0, 128, 0, 0.5)", "rgba(255, 165, 0, 0.5)", "rgba(255, 0, 0, 0.5)", "rgba(255, 0, 255, 0.5)", "rgba(128, 0, 128, 0.5)", "rgba(30, 144, 255, 0.5)"
//Green, Orange, Red, Magenta, Purple, Dodger Blue//
]
return {categoricalRange};
}});

define({id: "66c2b597", inputs: ["html","categories","categoricalRange","Plot","own_house_filtered","own_land_filtered","display"], body: async (html,categories,categoricalRange,Plot,own_house_filtered,own_land_filtered,display) => {
display(await(
html.fragment`<span style="font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1;">
    Men and women who own a house or land by sex
</span>
<color-legend
  titleText=""
  width="1200"
  height="22"
  scaletype="categorical"
  marktype="circle"
  domain='${JSON.stringify(categories)}'
  range='${JSON.stringify(categoricalRange)}'
></color-legend>
<table>
<tr>
  <td>${Plot.plot({
  color: { legend: false, range: ["dodgerblue", "magenta", "green", "purple" , "orange", "red", "gray"], opacity : 0.8 },
  insetTop: 10,
  insetRight: 10,
  insetBottom: 10,
  insetLeft: 10,
  height: 400,
  width: 500,
  y: { percent: false,domain:[0,100], grid: true },
  x: { percent: false, domain:[0,100], grid: true },
  caption: "Own House",
  marks: [
    Plot.dot(own_house_filtered, {
      x: "Male Value",
      y: "Female Value",
      stroke: "Region",
      fill: "Region",
      opacity: 0.4,
      channels: {Year: "Year", Country: "Country Name"},
      tip: true
    }),
    Plot.ruleX([0]),
    Plot.ruleY([0]),
    Plot.link([0], {
      x1: 0,
      y1: 0,
      x2: 100,
      y2: 100,
      strokeDasharray: "5,3",
      strokeOpacity: (k) => k === 1 ? 1 : 0.2
    }),
  ],
})}</td><td>${Plot.plot({
  color: { legend: false, range: ["dodgerblue", "magenta", "green", "purple" , "orange", "red", "gray"], opacity : 0.8 },
  insetTop: 10,
  insetRight: 10,
  insetBottom: 10,
  insetLeft: 10,
  height: 400,
  width: 500,
  y: { percent: false,domain:[0,80], grid: true },
  x: { percent: false, domain:[0,80], grid: true },
  caption: "Own Land",
  marks: [
    Plot.dot(own_land_filtered, {
      x: "Male Value",
      y: "Female Value",
      stroke: "Region",
      fill: "Region",
      opacity: 0.4,
      channels: {Year: "Year", Country: "Country Name"},
      tip: true
    }),
    Plot.ruleX([0]),
    Plot.ruleY([0]),
    Plot.link([0], {
      x1: 0,
      y1: 0,
      x2: 100,
      y2: 100,
      strokeDasharray: "5,3",
      strokeOpacity: (k) => k === 1 ? 1 : 0.2
    }),
  ],
})}</td>
</tr>
</table>
<span style="font-family: Andes, Arial, sans-serif;">
    <sub>Source: <a href="https://genderdata.worldbank.org/topics/assets">World Bank</a></sub>
</span>
`
))
}});

define({id: "0043ad4d", inputs: ["FileAttachment"], outputs: ["marriage_grants_equal_authority"], body: async (FileAttachment) => {
const marriage_grants_equal_authority = await FileAttachment("./data/marriage_grants_equal_authority.png").image()
return {marriage_grants_equal_authority};
}});

define({id: "9c1c287e", inputs: ["FileAttachment","display"], body: async (FileAttachment,display) => {
display(await(
(await FileAttachment("./data/marriage_grants_equal_authority.png")).image()
))
}});

define({id: "3be46bfd", inputs: ["country_and_lending_group_classification_economies"], outputs: ["economies_name_map"], body: (country_and_lending_group_classification_economies) => {
const economies_name_map = (() => country_and_lending_group_classification_economies.map((country) => {
  switch (country) {
    case "Côte d’Ivoire":
      return "Cote d'Ivoire";
    case "Czech Republic":
      return "Czechia";
    case "São Tomé and Príncipe":
      return "Sao Tome and Principe";
    case "Türkiye":
      return "Turkiye";
    default:
      return country;
  }
}))();
return {economies_name_map};
}});

define({id: "235da8fa", inputs: ["assets","economies_name_map","country_and_lending_group_classifications"], outputs: ["equal_authority_and_rights"], body: (assets,economies_name_map,country_and_lending_group_classifications) => {
const equal_authority_and_rights = assets
  // Filter assets based on specific indicators
  .filter(asset => [
    // The law grants spouses equal administrative authority over assets during marriage (1=yes; 0=no)
    'SG.LAW.ASST.AR',
    // Sons and daughters have equal rights to inherit assets from their parents (1=yes; 0=no)
    'SG.IHT.ASST.PT.EQ'
  ].includes(asset['Indicator Code']))
// Process each filtered asset
  .map(asset => {
    // Correct country name based on a mapping
    const correctedCountryName = economies_name_map.find(entry =>
      entry.includes(asset['Country Name'])
    );
    // Find classification data based on the corrected country name
    const classification = country_and_lending_group_classifications.find(c =>
      c.Economy === correctedCountryName
    );
    // If classification data is found, add Region and Income group properties to the asset
    if (classification) {
      return {
        ...asset,
        Region: classification.Region,
        'Income group': classification['Income group'],
      };
    }
    // If no classification data is found, set Region and Income group properties to null
    return {
      ...asset,
      Region: null,
      'Income group': null,
    };
  })
  // Filter out assets without complete classification information
  .filter(asset => asset['Region'] !== null && asset['Income group'] !== null);
return {equal_authority_and_rights};
}});

define({id: "502b1b52", inputs: ["view","Inputs","equal_authority_and_rights"], body: (view,Inputs,equal_authority_and_rights) => {
view(Inputs.table(equal_authority_and_rights))
}});

define({id: "61d00e74", inputs: ["assets","economies_name_map","country_and_lending_group_classifications"], outputs: ["equal_authority_and_rights_2021"], body: (assets,economies_name_map,country_and_lending_group_classifications) => {
const equal_authority_and_rights_2021 = assets
  .filter(asset => [
    // The law grants spouses equal administrative authority over assets during marriage (1=yes; 0=no)
    'SG.LAW.ASST.AR',
    // Sons and daughters have equal rights to inherit assets from their parents (1=yes; 0=no)
    'SG.IHT.ASST.PT.EQ'
  ].includes(asset['Indicator Code']) && asset['Year'] === 2021)
  .map(asset => {
    const correctedCountryName = economies_name_map.find(entry =>
      entry.includes(asset['Country Name'])
    );

    const classification = country_and_lending_group_classifications.find(c =>
      c.Economy === correctedCountryName
    );

    if (classification) {
      return {
        ...asset,
        Region: classification.Region,
        'Income group': classification['Income group'],
      };
    }

    return {
      ...asset,
      Region: null,
      'Income group': null,
    };
  })
  .filter(asset => asset['Region'] !== null && asset['Income group'] !== null);
return {equal_authority_and_rights_2021};
}});

define({id: "c56c1116", inputs: ["Plot","equal_authority_and_rights_2021","display"], body: async (Plot,equal_authority_and_rights_2021,display) => {
display(await(
Plot.plot({
  color: { legend: false },
  //marginRight: 160,
  marginLeft: 200,
  inset: 12,
  marks: [
    Plot.frame({ strokeOpacity: 0.1 }),
    Plot.dot(
      equal_authority_and_rights_2021,
      Plot.group(
        { r: "count" },
        {
          fy: "Region",
          x: "Country Name",
          y: "Indicator Code",
          stroke: d => {
            if (d["Indicator Code"] === "SG.IHT.ASST.PT.EQ") {
              return d.Value === 1 ? "rgb(231, 173, 0)" : "rgb(231, 219, 183)";
            }
            else if (d["Indicator Code"] === "SG.LAW.ASST.AR") {
              return d.Value === 1 ? "rgb(0, 86, 231)" : "rgb(138, 161, 231)";
            }
          },
          fill: d => {
            if (d["Indicator Code"] === "SG.IHT.ASST.PT.EQ") {
              return d.Value === 1 ? "rgb(231, 173, 0)" : "rgb(231, 219, 183)";
            }
            else if (d["Indicator Code"] === "SG.LAW.ASST.AR") {
              return d.Value === 1 ? "rgb(0, 86, 231)" : "rgb(138, 161, 231)";
            }
          },
          tip: {
            format: {
              fill: false,
              stroke: false,
              r: false,
            },
          },
          symbol: "square",
        }
      )
    )
  ],
  x: { axis: null },
  y: { axis: null },
})
))
}});

define({id: "9a786a25", inputs: ["d3","equal_authority_and_rights_2021"], outputs: ["equal_authority_and_rights_2021_sorted"], body: (d3,equal_authority_and_rights_2021) => {
const equal_authority_and_rights_2021_sorted = ((() => {
  // Define an array of region names in a specific order.
  const regions = [
    "East Asia & Pacific",
    "Europe & Central Asia",
    "Latin America & Caribbean",
    "Middle East & North Africa",
    "South Asia",
    "Sub-Saharan Africa",
    "North America"
  ];
  // Use D3.js to group the input data by "Country Name".
  // Then sort the groups based on the index of their corresponding region in the defined regions array.
  // The sorting is done in descending order (-) of the region index.
  // Finally, format the sorted data as `${v[1].Value} / ${v[0].Value}`.
  return d3
    .sort(
      // Group the input data by "Country Name".
      d3
        .group(equal_authority_and_rights_2021, (d) => d["Country Name"])
        .values(),
      // Sort the groups based on the index of the region in the predefined regions array.
      (v) => -regions.indexOf(v[0].Region),
      // Format the sorted data as `${v[1].Value} / ${v[0].Value}`.
      (v) => `${v[1].Value} / ${v[0].Value}`
    )
     // Reverse the sorted array.
    .reverse()
    // Flatten the array, removing nested arrays.
    .flat();
}))();
return {equal_authority_and_rights_2021_sorted};
}});

define({id: "36911c37", inputs: ["htl","d3","equal_authority_and_rights_2021_sorted","Plot","display"], body: async (htl,d3,equal_authority_and_rights_2021_sorted,Plot,display) => {
display(await(
htl.html`
<span style="font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1;">
Law grants spouses equal administrative authority over assets during marriage; <br/>Sons and daughters have equal rights to inherit assets from their parents
</span>
</p>
<div style="display: flex; flex-wrap: wrap; margin-left: 40px;">
${d3
  .rollup(
    equal_authority_and_rights_2021_sorted,
    (v) =>
      ((chart) => {
        d3.select(chart).on("mouseenter", function () {
          d3.select(this.parentElement).selectAll("svg").style("z-index", 0);
          d3.select(this).style("z-index", 1); // for the tooltip to be over the neighbors
        });
        return chart;
      })(
        Plot.plot({
          style: "overflow: visible; background: transparent;",
          width: 280,
          height: 100,
          x: { axis: null, insetLeft: 4, insetRight: 160, domain: [0, 19] },
          y: { reverse: true, axis: null, inset: 3 },
          fy: {
            paddingInner: 0,
            axis: null,
            domain: [-1, 0, 1, 2],
            insetBottom: 20
          },
          opacity: { range: [0.5, 1] },
          color: { range: ["rgb(231, 173, 0)", "rgb(0, 86, 231)"] },
          marks: [
            Plot.text([v[0].Region], {
              frameAnchor: "bottom-left",
              fontSize: 17,
              facetAnchor: "top",
              dy: -4
            }),
            Plot.dot(v, {
              x: (d, i) => Math.floor((i % 40) / 2),
              fy: (d, i) => Math.floor(i / 40),
              y: "Indicator Code",
              fill: "Indicator Code",
              fillOpacity: { value: "Value", scale: "opacity" },
              symbol: "square",
              r: 3,
                            channels: {"Country": "Country Name",
                        "Equal Rights to Inherit" : (d) => {
            if (d["Indicator Code"] === "SG.IHT.ASST.PT.EQ") {
              return d.Value === 1 ? "Yes" : "No";
            }},
                        "Spouse Equal Authority" : (d) => {
            if (d["Indicator Code"] === "SG.LAW.ASST.AR") {
              return d.Value === 1 ? "Yes" : "No";
            }

          },
                        },
              tip: {
                format: {
                  x: false,
                  fy: false,
                  fill: false,
                  fillOpacity: false,
                }
              }
            })
          ]
        })
      ),
    (d) => d.Region
  )
  .values()}
</div>
<span style="font-family: Andes, Arial, sans-serif;">
    <sub>Source: <a href="https://genderdata.worldbank.org/topics/assets">World Bank</a></sub>
</span>`
))
}});

</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#objective">Objective</a></li>
<li class="observablehq-secondary-link"><a href="#data-access">Data Access</a></li>
<li class="observablehq-secondary-link"><a href="#initial-explorations">Initial Explorations</a></li>
<li class="observablehq-secondary-link"><a href="#reproducing-visualizations">Reproducing Visualizations</a></li>
<li class="observablehq-secondary-link"><a href="#acknowledgements">Acknowledgements</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="world-bank-gender-data-portal-%7C-assets" tabindex="-1"><a class="observablehq-header-anchor" href="#world-bank-gender-data-portal-%7C-assets">World Bank Gender Data Portal | <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer">Assets</a></a></h1>
<p>The World Bank's <a href="https://genderdata.worldbank.org/" target="_blank" rel="noopener noreferrer">Gender Data Portal</a> makes the latest gender statistics accessible through compelling narratives and data visualizations to improve the understanding of gender data and facilitate analyses that inform policy choices.</p>
<p>The complete record of Gender Data is available for download in <a href="https://databank.worldbank.org/data/download/Gender_Stats_CSV.zip" target="_blank" rel="noopener noreferrer"><code>.csv</code></a> and<a href="https://databank.worldbank.org/data/download/Gender_Stats_EXCEL.zip" target="_blank" rel="noopener noreferrer"> Excel</a> formats as well as being accessible by <a href="https://genderdata.worldbank.org/help#access" target="_blank" rel="noopener noreferrer">API</a>.<sup><a href="https://genderdata.worldbank.org/help/#access" target="_blank" rel="noopener noreferrer">*</a></sup> Users can access the full dataset, or data for specific indicators within an indicator group, as well as for specific countries, regions, and topics.</p>
<hr>
<h2 id="objective" tabindex="-1"><a class="observablehq-header-anchor" href="#objective">Objective</a></h2>
<p>This notebook examines the <a href="https://genderdata.worldbank.org/#explore-topics" target="_blank" rel="noopener noreferrer">topic</a> of <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer">Assets</a>. We will walk through how to load in <code>asset</code> data and will reproduce the visualizations on the <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer">topic summary page</a>.</p>
<!--- -->
<div class="observablehq observablehq--block"><!--:24a81051:--></div>
<div class="observablehq observablehq--block"><!--:f7efae95:--></div>
<hr>
<h2 id="data-access" tabindex="-1"><a class="observablehq-header-anchor" href="#data-access">Data Access</a></h2>
<p>The Data Portal offers users a few ways to access <a href="https://genderdata.worldbank.org/topics/assets/" target="_blank" rel="noopener noreferrer">Assets</a> data, including a <a href="https://genderdata.worldbank.org/indicators/#assets" target="_blank" rel="noopener noreferrer">list of all asset indicators</a>,  <a href="https://genderdata.worldbank.org/data/download/zips/assets.zip" target="_blank" rel="noopener noreferrer"><code>.csv</code> file downloads</a> and API access via <a href="https://databank.worldbank.org/source/gender-statistics" target="_blank" rel="noopener noreferrer">Databank</a>.  The the topic page is also available as <a href="https://genderdata.worldbank.org/data/download/pdfs/topics/assets.pdf" target="_blank" rel="noopener noreferrer"><code>.pdf</code></a>.</p>
<p>Let's use the <a href="https://github.com/d3/d3-dsv" target="_blank" rel="noopener noreferrer">D3.js delimiter-separated value</a> module to load in the <code>.csv</code> file.</p>
<div class="observablehq observablehq--block"><!--:eb4a73b9:--></div>
<hr>
<h2 id="initial-explorations" tabindex="-1"><a class="observablehq-header-anchor" href="#initial-explorations">Initial Explorations</a></h2>
<p>Before we jump into the visualizations, let's get to know our data:</p>
<!--A quick way to explore the dataset is to use [Observable's data table cell](https://observablehq.com/@observablehq/data-table-cell). Here it is:-->
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:a02c80e6:--></div>
<p>The table view immediately shows us that each data entry consists of just <observablehq-loading></observablehq-loading><!--:7f120d88:--> variables, namely:</p>
<ul><observablehq-loading></observablehq-loading><!--:de272d84:--></ul>
<p>There are <observablehq-loading></observablehq-loading><!--:aedcbc08:--> years covered in the data set.</p>
<div class="observablehq observablehq--block"><!--:ce5734a4:--></div>
<p>And there are <observablehq-loading></observablehq-loading><!--:e3846d90:--> unique entries returned under the 'countries' variable.</p>
<div class="observablehq observablehq--block"><!--:3991cd80:--></div>
<p><observablehq-loading></observablehq-loading><!--:e3846d90-1:--> sounds pretty high, so let's take a closer look by grouping first by country, and then by indicator (which has the lovely effect of also helping us discover more how indicators are reported across countries).</p>
<p>While we aren't pulling these out programmatically, spotting the extra <code>country</code> entries is pretty quick just by reading the country grouping above. The 'extras' are higher-level aggregations offered for our convenience:</p>
<pre data-language="{langauge:javascript}"><code class="language-{langauge:javascript}">  "Arab World" 
  "East Asia &amp; Pacific" 
  "East Asia &amp; Pacific (excluding high income)" 
  "Euro area" 
  "Europe &amp; Central Asia" 
  "Europe &amp; Central Asia (excluding high income)" 
  "High income" 
  "Latin America &amp; Caribbean " 
  "Latin America &amp; Caribbean (excluding high income)"
  "LMY" 
  "Low income" 
  "Lower middle income" 
  "Middle East &amp; North Africa" 
  "Middle East &amp; North Africa (excluding high income)"
  "MIC" 
  "North America" 
  "OECD members" 
  "South Asia" 
  "Sub-Saharan Africa " 
  "Sub-Saharan Africa (excluding high income)"
  "Upper middle income"
  "World"
</code></pre>
<p>Our data are also comprised of <observablehq-loading></observablehq-loading><!--:32352be5:--> unique indicators.</p>
<div class="observablehq observablehq--block"><!--:b180f547:--></div>
<p>Not all indicators have values for each year, and not all countries have historically reported all values.</p>
<p>Grouping first by indicator, then by year, we see which indicators have greater or fewer observations across time.</p>
<div class="observablehq observablehq--block"><!--:5aff952e:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> indicators_group_year = [... <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(d3.<span class="hljs-title function_">flatGroup</span>(assets, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d[<span class="hljs-string">"Indicator Name"</span>], <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d[<span class="hljs-string">"Year"</span>]))]
</code></pre>
<p>Let's identify which indicator has the most observations for a single year:</p>
<div class="observablehq observablehq--block"><!--:d27ad9b3:--></div>
<p>And the fewest:</p>
<div class="observablehq observablehq--block"><!--:7280c7f4:--></div>
<p>Grouping another way, first by indicator and then by country, helps us to see which indicators have been tracked most regularly across countries and regions.</p>
<div class="observablehq observablehq--block"><!--:75f21ab6:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> indicators_group_year_country =  [... <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(d3.<span class="hljs-title function_">flatGroup</span>(assets, <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d[<span class="hljs-string">"Indicator Name"</span>], <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d[<span class="hljs-string">"Country Name"</span>]))]
</code></pre>
<div class="observablehq observablehq--block"><!--:56bd7279:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> indicators_group_year_country_max = <span class="hljs-title function_">display</span>((<span class="hljs-function">() =&gt;</span> {
<span class="hljs-keyword">let</span> maxObservations = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> indicatorWithMostObservations;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> indicators_group_year_country) {
  <span class="hljs-keyword">const</span> observations = entry[<span class="hljs-number">2</span>].<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (observations &gt; maxObservations) {
    maxObservations = observations;
    indicatorWithMostObservations = entry[<span class="hljs-number">0</span>];
  }
}

<span class="hljs-keyword">return</span> {
  <span class="hljs-string">"Indicator with the most observations for a single country or region"</span>: indicatorWithMostObservations,
  <span class="hljs-string">"Greatest number of observations for a single country or region"</span>: maxObservations
}
})())
</code></pre>
<div class="observablehq observablehq--block"><!--:75d5b078:--></div>
<p>Fantastic!  With just a few simple pivot-style transformations, we are learning quite a lot about our data.</p>
<hr>
<h2 id="reproducing-visualizations" tabindex="-1"><a class="observablehq-header-anchor" href="#reproducing-visualizations">Reproducing Visualizations</a></h2>
<p>Now let's have a look at how the World Bank showcases the <code>assets</code> dataset.</p>
<hr>
<h3 id="account-ownership-at-a-financial-institution-or-with-a-mobile-money-service-provider-by-sex-and-income-group" tabindex="-1"><a class="observablehq-header-anchor" href="#account-ownership-at-a-financial-institution-or-with-a-mobile-money-service-provider-by-sex-and-income-group">Account ownership at a financial institution or with a mobile-money-service provider by sex and income group</a></h3>
<p>Here's the first visualization on the <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer"><code>Assets</code> topic summary</a> page:</p>
<div class="observablehq observablehq--block"><!--:a26f89d7:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:638b98a0:--></div>
<p>This visualization shows `<code>account ownership at a financial institution or with a mobile-money-service provider by sex and income group</code>`. Data are a weighted average, aggregated and faceted by economy (the income group classification for each country). The visualization helps to compare the male and female values for each region and across regions.</p>
<p>As we discovered in reviewing the data for <a href="https://observablehq.com/d/7fb248de83bc0ad4#countries_group" target="_blank" rel="noopener noreferrer"><code>countries_group</code></a>, above, the source <a href="https://observablehq.com/d/7fb248de83bc0ad4#assets" target="_blank" rel="noopener noreferrer"><code>assets</code></a> data file already contains aggregated regional vales.</p>
<div class="observablehq observablehq--block"><!--:0dab33d8:--></div>
<p>We can filter down our <code>assets</code> data to focus just on those indicators of interest for our visualization namely <code>FX.OWN.TOTL.FE.ZS</code> (Account ownership at a financial institution or with a mobile-money-service provider, female (% of population ages 15+) and <code>FX.OWN.TOTL.MA.ZS'</code> (Account ownership at a financial institution or with a mobile-money-service provider, male (% of population ages 15+).  Also, because we wish to easily distinguish values by sex, we'll add an additional column to help make this distinction.</p>
<div class="observablehq observablehq--block"><!--:1f1ab114:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> aggregated_account_ownership = assets.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> countryNameMatch = [
  <span class="hljs-string">'High income'</span>,
  <span class="hljs-string">'Upper middle income'</span>,
  <span class="hljs-string">'Lower middle income'</span>,
  <span class="hljs-string">'Low income'</span>
]
    <span class="hljs-comment">// This bit refines our search for specfic indicators</span>
  .<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Country Name'</span>]);
  <span class="hljs-keyword">const</span> indicatorCodeMatch = [
  <span class="hljs-string">'FX.OWN.TOTL.FE.ZS'</span>,
  <span class="hljs-string">'FX.OWN.TOTL.MA.ZS'</span>
].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]);
  <span class="hljs-keyword">return</span> countryNameMatch &amp;&amp; indicatorCodeMatch;
})
    <span class="hljs-comment">// This bit adds an additional column as a helper, called 'Sex' (for lack of a better word)</span>
    <span class="hljs-comment">// We use it because it can be dizzying to look at just the indicator codes.</span>
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">Sex</span> = asset[<span class="hljs-string">'Indicator Code'</span>] === <span class="hljs-string">'FX.OWN.TOTL.FE.ZS'</span> ? <span class="hljs-string">'Female'</span> : <span class="hljs-string">'Male'</span>;
  <span class="hljs-keyword">return</span> { <span class="hljs-title class_">Sex</span>, ...asset };
})
</code></pre>
<p>Before we plot the data, let's quickly review our filtered results and anticipate surprises.  <!--For this, let's use the data table cell.--></p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:a98fb9a9:--></div>
<p>The table view shows us that we have data for multiple years.  As we create a dot plot similar to the one on the <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer">Gender Portal <code>Assets</code> page</a>, which plots values for men and women as dots along a shared access and connects them with a line between each point, we can facet by year.</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:10f6daa6:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">plot</span>({
  <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">150</span>,
  width,
  <span class="hljs-attr">color</span>: { <span class="hljs-attr">range</span>: [<span class="hljs-string">"orange"</span>, <span class="hljs-string">"purple"</span>] },
  <span class="hljs-attr">fx</span>: { <span class="hljs-attr">tickFormat</span>: <span class="hljs-string">"d"</span> },
  <span class="hljs-attr">x</span>: { <span class="hljs-attr">domain</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">100</span>], <span class="hljs-attr">ticks</span>: <span class="hljs-number">5</span> },
  <span class="hljs-attr">fy</span>: {<span class="hljs-attr">domain</span>:  [<span class="hljs-string">"Low income"</span>,<span class="hljs-string">"Lower middle income"</span>, <span class="hljs-string">"Upper middle income"</span>, <span class="hljs-string">"High income"</span>] },
  <span class="hljs-attr">marks</span>: [
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">frame</span>(),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">ruleY</span>(
      aggregated_account_ownership,
      <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">groupZ</span>(
        { <span class="hljs-attr">x1</span>: <span class="hljs-string">"min"</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">"max"</span> },
        { <span class="hljs-attr">x1</span>: <span class="hljs-string">"Value"</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">"Value"</span>, <span class="hljs-attr">y</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">fx</span>: <span class="hljs-string">"Year"</span>, <span class="hljs-attr">fy</span>: <span class="hljs-string">"Country Name"</span> }
      )
    ),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">dotX</span>(
      aggregated_account_ownership,
      <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">groupX</span>(
        { <span class="hljs-attr">x</span>: <span class="hljs-string">"mean"</span> },
        { <span class="hljs-attr">x</span>: <span class="hljs-string">"Value"</span>, <span class="hljs-attr">fill</span>: <span class="hljs-string">"Sex"</span>, <span class="hljs-attr">r</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">fx</span>: <span class="hljs-string">"Year"</span>, <span class="hljs-attr">fy</span>: <span class="hljs-string">"Country Name"</span>, <span class="hljs-attr">tip</span>: <span class="hljs-literal">true</span>, }
      )
    )
  ]
})
</code></pre>
<p>It looks like the visualization on the <code>Assets</code> page focuses on values from the most recent year. Here's a recreation of that chart:</p>
<hr>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:d33b55e7:--></div>
<pre data-language="html"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1;"</span>&gt;</span>
    Account ownership at a financial institution<span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span>
    or with a mobile-money-service provider<span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span>
    by sex and income group
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
${Plot.plot({
  marginLeft: 150,
  width: width*0.9,
  height: width*0.4,
  color: { range: ["orange", "purple"], legend: true },
  fx: { tickFormat: "d" },
  x: { domain: [0, 100], ticks: 5 },
  fy: {domain:  ["Low income","Lower middle income", "Upper middle income", "High income"] },
  marks: [
    Plot.frame({ strokeOpacity: 0.2 }),
    Plot.ruleY(
      aggregated_account_ownership.filter(d =&gt; d.Year === 2017),
      Plot.groupZ(
        { x1: "min", x2: "max" },
        { x1: "Value", x2: "Value", y: null, fx: "Year", fy: "Country Name" }
      )
    ),
    Plot.dotX(
      aggregated_account_ownership.filter(d =&gt; d.Year === 2017),
      Plot.groupX(
        { x: "mean" },
        { x: "Value", fill: "Sex", r: 9, fx: "Year", fy: "Country Name", tip: {
              format: {
                Sex: true,
                Value: true,
                fx: false,
                fy: true,
              }
            }, }
      )
    )
  ]
})}
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-family: Andes, Arial, sans-serif;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sub</span>&gt;</span>Source: <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://genderdata.worldbank.org/topics/assets"</span>&gt;</span>World Bank<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sub</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
</code></pre>
<hr>
<p>Splendid. We have effectively reproduced the visualization.  Of course, there's still some room for improvement, but let's keep up the momentum and turn our attention to the next chart.</p>
<hr>
<h3 id="saved-any-money-in-the-past-year-by-sex-and-income-group" tabindex="-1"><a class="observablehq-header-anchor" href="#saved-any-money-in-the-past-year-by-sex-and-income-group">Saved any money in the past year by sex and income group</a></h3>
<p>The second visualization on the <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer"><code>Assets</code> topic summary</a> page compares the percent of population above age 15 that saved any money in the past year.</p>
<div class="observablehq observablehq--block"><!--:06290dc8:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:50f77ef9:--></div>
<p>Reproducing this visualization is a very similar process to our first exercise: just focus on our target indicator and economies.</p>
<div class="observablehq observablehq--block"><!--:b361b205:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> aggregated_money_savings_last_year = assets.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> countryNameMatch = [
  <span class="hljs-string">'High income'</span>,
  <span class="hljs-string">'Upper middle income'</span>,
  <span class="hljs-string">'Lower middle income'</span>,
  <span class="hljs-string">'Low income'</span>
]
    <span class="hljs-comment">// This bit refines our search for specfic indicators</span>
  .<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Country Name'</span>]);
  <span class="hljs-keyword">const</span> indicatorCodeMatch = [
  <span class="hljs-string">'fin18.t.d.1'</span>,
  <span class="hljs-string">'fin18.t.d.2'</span>
].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]);
  <span class="hljs-keyword">return</span> countryNameMatch &amp;&amp; indicatorCodeMatch;
})
    <span class="hljs-comment">// This bit adds an additional column as a helper, called 'Sex' (for lack of a better word)</span>
    <span class="hljs-comment">// We use it because it can be dizzying to look at just the indicator codes.</span>
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">Sex</span> = asset[<span class="hljs-string">'Indicator Code'</span>] === <span class="hljs-string">'fin18.t.d.2'</span> ? <span class="hljs-string">'Female'</span> : <span class="hljs-string">'Male'</span>;
  <span class="hljs-keyword">return</span> { <span class="hljs-title class_">Sex</span>, ...asset };
})
</code></pre>
<p>Before visualizing, let's again have a quick review of the data.</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:2349f2e7:--></div>
<p>We again have data for multiple years.  Let's first plot a simple stacked bar chart with facets for the two years represented in the dataset for the sake of comparison.</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:7f7ddce9:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">plot</span>({
  <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">width</span>: width*<span class="hljs-number">0.9</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">color</span>: { <span class="hljs-attr">range</span>: [<span class="hljs-string">"orange"</span>, <span class="hljs-string">"purple"</span>, <span class="hljs-string">"#ccc"</span>], <span class="hljs-attr">legend</span>: <span class="hljs-literal">true</span>,  },
  <span class="hljs-attr">y</span>: {<span class="hljs-attr">domain</span>:  [<span class="hljs-string">"Low income"</span>,<span class="hljs-string">"Lower middle income"</span>, <span class="hljs-string">"Upper middle income"</span>, <span class="hljs-string">"High income"</span>] },
  <span class="hljs-attr">marks</span>: [
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">frame</span>({ <span class="hljs-attr">strokeOpacity</span>: <span class="hljs-number">0.2</span> }),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">barX</span>(aggregated_money_savings_last_year, {
      <span class="hljs-attr">fy</span>: <span class="hljs-string">"Year"</span>,
      <span class="hljs-attr">x1</span>: <span class="hljs-string">"Value"</span>,
      <span class="hljs-attr">sort</span>: <span class="hljs-string">"Value"</span>, <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-string">"Country Name"</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"Sex"</span>,
      <span class="hljs-attr">tip</span>: {
              <span class="hljs-attr">format</span>: {
                <span class="hljs-title class_">Sex</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-title class_">Value</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">y</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">x2</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">fy</span>: <span class="hljs-literal">false</span>,
              }
            },
    }),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">ruleX</span>([<span class="hljs-number">0</span>])
  ]
})
</code></pre>
<p>The values are fairly close between 2014 and 2017, although the reported number of women saving money in 'upper middle income' countries appears to have gone down significantly.  Also, the values being returned by the <a href="https://observablehq.com/d/7fb248de83bc0ad4#assets" target="_blank" rel="noopener noreferrer"><code>assets</code></a> dataset are not the same as those shown in the official visualizations.  <em>This may be something to inquire into later.</em></p>
<p>For now, it's time to try to recreate the World Bank visualization.</p>
<p>Let's first filter the data to focus on the most recent year (2017):</p>
<div class="observablehq observablehq--block"><!--:03d1ac18:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> aggregated_money_savings_last_year_2017 = aggregated_money_savings_last_year.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">Year</span> === <span class="hljs-number">2017</span>);
</code></pre>
<p>And next, let's render the chart:</p>
<hr>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:5fecd49b:--></div>
<pre data-language="html"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1; padding-right:40px;"</span>&gt;</span>
    Saved any money <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>in the past year <span class="hljs-tag">&lt;<span class="hljs-name">sub</span>&gt;</span>(2017)<span class="hljs-tag">&lt;/<span class="hljs-name">sub</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-family: Andes, Arial, sans-serif;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sub</span>&gt;</span>Source: <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://genderdata.worldbank.org/topics/assets"</span>&gt;</span>World Bank<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sub</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
${Plot.plot({
  marginLeft: 0,
  marginTop: 20,
  height: 140,
  width: 500,
  color: { range: ["orange", "purple"], legend: true },
  facet: {
    data: aggregated_money_savings_last_year_2017,
    x: (d) =&gt; !["Low income", "Upper middle income"].includes(d["Country Name"]),
    y: (d) =&gt; !["Low income", "Lower middle income"].includes(d["Country Name"])
  },
  x: {axis: null, domain: [0, 100]},
  y: {axis: null},
  fx: {axis: null},
  fy: {axis: null, paddingInner: 0.4},
  marks: [
    //Plot.frame(),
    Plot.text(aggregated_money_savings_last_year_2017, Plot.selectFirst({
      frameAnchor: "top-left",
      text: "Country Name",
      lineAnchor: "bottom",
      fontSize: 14,
      fontWeight: "bold",
      dy: -5
    })),
    Plot.rectX(aggregated_money_savings_last_year_2017, {
      fill: "Sex",
      reverse: true,
      y1: d =&gt; d.Sex === "Male" ? 1.5 : 0,
      y2: d =&gt; d.Sex === "Male" ? 4 : 2.5,
      x2: "Value",
      tip:{
              format: {
                Sex: true,
                Value: true,
                x1: false,
                y: false,
                fx: false,
                fy: false,
              }
            },
    }),
    Plot.textX(aggregated_money_savings_last_year_2017, {
      fill: "Sex",
      filter: (d) =&gt; d.Sex === "Female",
      text: d =&gt; `${d.Value.toFixed(1)}%`,
      textAnchor: "start",
      fontSize: 14,    
      insetTop: 10,
      dx: 4,
      frameAnchor: "bottom",
      fontWeight: "bold",
      x: "Value"
    }),
    Plot.textX(aggregated_money_savings_last_year_2017, {
      fill: "Sex",
      filter: (d) =&gt; d.Sex === "Male",
      text: d =&gt; `${d.Value.toFixed(1)}%`,
      textAnchor: "start",
      fontSize: 14,
      insetTop: 10,
      frameAnchor: "top",
      fontWeight: "bold",
      dx: 4,
      x: "Value"
    })
  ]
})}
      <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
<hr>
<p>Excellent.</p>
<hr>
<h3 id="men-and-women-who-own-a-house-or-land-by-sex" tabindex="-1"><a class="observablehq-header-anchor" href="#men-and-women-who-own-a-house-or-land-by-sex">Men and women who own a house or land by sex</a></h3>
<p>This third visualization from the Gender Portal <a href="https://genderdata.worldbank.org/topics/assets" target="_blank" rel="noopener noreferrer"><code>Assets</code> topic summary</a> page is comprised of two scatter plots.  The visualization shows distributions of economies by the percentage of men and women who own a house alone, jointly, or both alone and jointly. The chart on the left shows these ownership distributions for houses.  The chart on the right shows distributions for land.</p>
<div class="observablehq observablehq--block"><!--:37487953:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:a581caa2:--></div>
<p>In order to create this visualization, our data must be encoded with both economy and region so that we can assign colors to the dots. As the source <a href="https://observablehq.com/d/7fb248de83bc0ad4#assets" target="_blank" rel="noopener noreferrer"><code>assets.csv</code></a> file does not contain this encoding (it provides only regional aggregates; it does not identify country assignments to regions), we must find a reference index.  For this, we'll use the World Bank <a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups" target="_blank" rel="noopener noreferrer">Country and Lending Groups</a> classifications.</p>
<div class="observablehq observablehq--block"><!--:a38f7cc0:--></div>
<p>Before going further, let's pause to verify whether the names of countries/economies in the <code>country_and_lending_group_classifications</code> dataset matches those we have for gender <code>assets</code>.</p>
<p>For our comparison, we first want to filter out all the aggregation values for economies, such as '<code>${country_and_lending_group_classifications[220].Economy}</code>', so that we're with just the values for countries.</p>
<p>These are the regional assignments:</p>
<div class="observablehq observablehq--block"><!--:97faa437:--></div>
<p>And here's the list of economies represented in the <code>country_and_lending_group_classifications</code> dataset:</p>
<div class="observablehq observablehq--block"><!--:686817ae:--></div>
<p>The classification dataset comprises <observablehq-loading></observablehq-loading><!--:21c61865:--> economies— <observablehq-loading></observablehq-loading><!--:be498988:--> more than in our <a href="https://observablehq.com/d/7fb248de83bc0ad4#assets" target="_blank" rel="noopener noreferrer"><code>assets</code></a> dataset.  There are also a a few economies that have slightly different names and spellings.  Let's write a function to help us compare these two datasets so that we can see exactly where they differ:</p>
<div class="observablehq observablehq--block"><!--:ed513226:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">compare_country_datasets</span>(<span class="hljs-params">source, comparison</span>) {
  <span class="hljs-keyword">const</span> common_countries = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(source).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">country</span> =&gt;</span> comparison.<span class="hljs-title function_">has</span>(country));
  <span class="hljs-keyword">const</span> source_countries = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(source).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">country</span> =&gt;</span> !comparison.<span class="hljs-title function_">has</span>(country));
  <span class="hljs-keyword">const</span> comparison_countries = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(comparison).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">country</span> =&gt;</span> !source.<span class="hljs-title function_">has</span>(country));

  <span class="hljs-keyword">return</span> {<span class="hljs-attr">common_values</span>: common_countries, <span class="hljs-attr">source_unique</span>: source_countries, <span class="hljs-attr">comparison_unique</span>: comparison_countries};
}
</code></pre>
<div class="observablehq observablehq--block"><!--:3354aca3:--></div>
<p>Let's take a moment to re-map the names of economies in the <code>country_and_lending_group_classification_economies</code> to match those in our <code>assets</code> dataset:</p>
<div class="observablehq observablehq--block"><!--:a7d00bba:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> economies_renamed = country_and_lending_group_classifications.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> ({ ...c, <span class="hljs-title class_">Economy</span>: { <span class="hljs-string">"Côte d’Ivoire"</span>: <span class="hljs-string">"Cote d'Ivoire"</span>, <span class="hljs-string">"Czech Republic"</span>: <span class="hljs-string">"Czechia"</span>, <span class="hljs-string">"São Tomé and Príncipe"</span>: <span class="hljs-string">"Sao Tome and Principe"</span>, <span class="hljs-string">"Türkiye"</span>: <span class="hljs-string">"Turkiye"</span> }[c.<span class="hljs-property">Economy</span>] || c.<span class="hljs-property">Economy</span> }));
</code></pre>
<p>With this step accomplished, it's time to filter down to our target indicators. We'll start by focusing on house ownership:</p>
<div class="observablehq observablehq--block"><!--:3cd66100:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> own_house = assets.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> countryNameMatch = economies_renamed.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span>
    entry.<span class="hljs-property">Economy</span> === asset[<span class="hljs-string">'Country Name'</span>]
  );

  <span class="hljs-keyword">const</span> indicatorCodeMatch = [
    <span class="hljs-string">'SG.OWN.HSAL.FE.ZS'</span>,
    <span class="hljs-string">'SG.OWN.HSAL.MA.ZS'</span>,
    <span class="hljs-string">'SG.OWN.HSJT.FE.ZS'</span>,
    <span class="hljs-string">'SG.OWN.HSJT.MA.ZS'</span>,
    <span class="hljs-string">'SG.OWN.HSAJ.FE.ZS'</span>,
    <span class="hljs-string">'SG.OWN.HSAJ.MA.ZS'</span>,
  ].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]);

  <span class="hljs-keyword">return</span> countryNameMatch &amp;&amp; indicatorCodeMatch;
})
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> isFemaleIndicator = [
      <span class="hljs-string">'SG.OWN.HSAL.FE.ZS'</span>,
      <span class="hljs-string">'SG.OWN.HSJT.FE.ZS'</span>,
      <span class="hljs-string">'SG.OWN.HSAJ.FE.ZS'</span>
    ].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]);

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">Sex</span> = isFemaleIndicator ? <span class="hljs-string">'Female'</span> : <span class="hljs-string">'Male'</span>;

    <span class="hljs-keyword">const</span> classification = economies_renamed.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span>
      c.<span class="hljs-property">Economy</span> === asset[<span class="hljs-string">'Country Name'</span>]
    );

    <span class="hljs-keyword">if</span> (classification) {
      <span class="hljs-keyword">return</span> {
        ...asset,
        <span class="hljs-title class_">Region</span>: classification.<span class="hljs-property">Region</span>,
        <span class="hljs-string">'Income group'</span>: classification[<span class="hljs-string">'Income group'</span>],
        <span class="hljs-title class_">Sex</span>
      };
    }

    <span class="hljs-keyword">return</span> { ...asset, <span class="hljs-title class_">Sex</span> };
});
</code></pre>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:77c86001:--></div>
<p>From the table above, we can quickly see that our filtered data comprises values from across several years—from 2010 to 2020.  Some countries report more observations than other, for instance with Senegal reporting the most and Turkey the least.  To recreate the World Bank visualization, we'll need to ensure that we're only looking at the most recent year where multiple years are present.  We'll also need to combine the reported values for each form of ownership (alone, jointly, or both alone and jointly).</p>
<p>Here's one way to accomplish this:</p>
<div class="observablehq observablehq--block"><!--:f00f9c38:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> own_house_filtered = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(
    <span class="hljs-comment">//Reduce the 'own_house' array to a key-value store with unique keys based on specific properties.</span>
    own_house.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">r, c</span>) =&gt;</span> {
      <span class="hljs-comment">// Create a unique key based on specific properties of the object.</span>
      <span class="hljs-keyword">const</span> key = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-string">"Country Name"</span>: c[<span class="hljs-string">"Country Name"</span>],
        <span class="hljs-string">"Country Code"</span>: c[<span class="hljs-string">"Country Code"</span>],
        <span class="hljs-string">"Year"</span>: c[<span class="hljs-string">"Year"</span>],
        <span class="hljs-string">"Region"</span>: c[<span class="hljs-string">"Region"</span>],
        <span class="hljs-string">"Income group"</span>: c[<span class="hljs-string">"Income group"</span>],
      });
      <span class="hljs-comment">// If the key does not exist in the result object, initialize it with specific properties and default values.</span>
      r[key] = r[key] || { ...c, <span class="hljs-string">"Female Value"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"Male Value"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"Indicator Name"</span>: <span class="hljs-string">"Own House"</span> };
      <span class="hljs-comment">// Check if the current entry corresponds to Female or Male Value indicator and update values accordingly.</span>
      <span class="hljs-keyword">const</span> isFemaleIndicator = [<span class="hljs-string">"SG.OWN.HSAL.FE.ZS"</span>, <span class="hljs-string">"SG.OWN.HSJT.FE.ZS"</span>, <span class="hljs-string">"SG.OWN.HSAJ.FE.ZS"</span>].<span class="hljs-title function_">includes</span>(c[<span class="hljs-string">"Indicator Code"</span>]);
      <span class="hljs-keyword">const</span> isMaleIndicator = [<span class="hljs-string">"SG.OWN.HSAL.MA.ZS"</span>, <span class="hljs-string">"SG.OWN.HSJT.MA.ZS"</span>, <span class="hljs-string">"SG.OWN.HSAJ.MA.ZS"</span>].<span class="hljs-title function_">includes</span>(c[<span class="hljs-string">"Indicator Code"</span>]);
      <span class="hljs-comment">// Update Female and Male Values based on the indicator type.</span>
      r[key][<span class="hljs-string">"Female Value"</span>] += isFemaleIndicator ? (<span class="hljs-built_in">isNaN</span>(c[<span class="hljs-string">"Value"</span>]) ? <span class="hljs-number">0</span> : c[<span class="hljs-string">"Value"</span>]) : <span class="hljs-number">0</span>;
      r[key][<span class="hljs-string">"Male Value"</span>] += isMaleIndicator ? (<span class="hljs-built_in">isNaN</span>(c[<span class="hljs-string">"Value"</span>]) ? <span class="hljs-number">0</span> : c[<span class="hljs-string">"Value"</span>]) : <span class="hljs-number">0</span>;

      <span class="hljs-keyword">return</span> r;
    }, {})
    <span class="hljs-comment">// Group the transformed data by unique keys (Country Name and Indicator Code)</span>
  ).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">groups, entry</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${entry[<span class="hljs-string">"Country Name"</span>]}</span>-<span class="hljs-subst">${entry[<span class="hljs-string">"Indicator Code"</span>]}</span>`</span>;
    <span class="hljs-comment">// If the key does not exist in the groups object, initialize it as an empty array.</span>
    groups[key] = groups[key] || [];
    <span class="hljs-comment">// Push the current entry into the corresponding group.</span>
    groups[key].<span class="hljs-title function_">push</span>(entry);
    <span class="hljs-keyword">return</span> groups;
  }, {})
  <span class="hljs-comment">//Extract the most recent data for Female and Male Values, filling missing Male Values with the last available value.</span>
).<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">group</span> =&gt;</span> {
  <span class="hljs-comment">// Find the most recent year in the current group.</span>
  <span class="hljs-keyword">const</span> mostRecentYear = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...group.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> entry[<span class="hljs-string">"Year"</span>]));
  <span class="hljs-keyword">let</span> lastMaleValue = <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">return</span> group
    <span class="hljs-comment">// Filter the entries for the most recent year and non-zero Female and Male Values.</span>
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> entry[<span class="hljs-string">"Year"</span>] === mostRecentYear &amp;&amp; entry[<span class="hljs-string">"Male Value"</span>] !== <span class="hljs-number">0</span> &amp;&amp; entry[<span class="hljs-string">"Female Value"</span>] !== <span class="hljs-number">0</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
      <span class="hljs-comment">// Fill missing Male Values with the last available value.</span>
      <span class="hljs-keyword">if</span> (entry[<span class="hljs-string">"Male Value"</span>] === <span class="hljs-number">0</span> &amp;&amp; lastMaleValue !== <span class="hljs-literal">null</span>) {
        entry[<span class="hljs-string">"Male Value"</span>] = lastMaleValue;
      } <span class="hljs-keyword">else</span> {
        lastMaleValue = entry[<span class="hljs-string">"Male Value"</span>];
      }
      <span class="hljs-keyword">return</span> entry;
    });
})
</code></pre>
<p>Let's plot the results and see how close we are...</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:f0c643a4:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">plot</span>({
  <span class="hljs-attr">color</span>: { <span class="hljs-attr">legend</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">range</span>: [<span class="hljs-string">"dodgerblue"</span>, <span class="hljs-string">"magenta"</span>, <span class="hljs-string">"green"</span>, <span class="hljs-string">"purple"</span> , <span class="hljs-string">"orange"</span>, <span class="hljs-string">"red"</span>, <span class="hljs-string">"gray"</span>], opacity : <span class="hljs-number">0.8</span> },
  <span class="hljs-attr">insetTop</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">insetRight</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">insetBottom</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">insetLeft</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
  <span class="hljs-attr">width</span>: <span class="hljs-number">500</span>,
  <span class="hljs-attr">y</span>: { <span class="hljs-attr">percent</span>: <span class="hljs-literal">false</span>,<span class="hljs-attr">domain</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">100</span>], <span class="hljs-attr">grid</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">x</span>: { <span class="hljs-attr">percent</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">domain</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">100</span>], <span class="hljs-attr">grid</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">caption</span>: <span class="hljs-string">"Own House"</span>,
  <span class="hljs-attr">marks</span>: [
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">dot</span>(own_house_filtered, {
      <span class="hljs-attr">x</span>: <span class="hljs-string">"Male Value"</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-string">"Female Value"</span>,
      <span class="hljs-attr">stroke</span>: <span class="hljs-string">"Region"</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"Region"</span>,
      <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.4</span>,
      <span class="hljs-attr">channels</span>: {<span class="hljs-title class_">Year</span>: <span class="hljs-string">"Year"</span>, <span class="hljs-title class_">Country</span>: <span class="hljs-string">"Country Name"</span>},
      <span class="hljs-attr">tip</span>: <span class="hljs-literal">true</span>
    }),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">ruleX</span>([<span class="hljs-number">0</span>]),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">ruleY</span>([<span class="hljs-number">0</span>]),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">link</span>([<span class="hljs-number">0</span>], {
      <span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">x2</span>: <span class="hljs-number">100</span>,
      <span class="hljs-attr">y2</span>: <span class="hljs-number">100</span>,
      <span class="hljs-attr">strokeDasharray</span>: <span class="hljs-string">"5,3"</span>,
      <span class="hljs-attr">strokeOpacity</span>: <span class="hljs-function">(<span class="hljs-params">k</span>) =&gt;</span> k === <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0.2</span>
    }),
  ],
})
</code></pre>
<p>Looking good!  Next let's repeat this process focusing on land ownership:</p>
<div class="observablehq observablehq--block"><!--:fe4e9792:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> own_land = assets.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> countryNameMatch = economies_renamed.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span>
    entry.<span class="hljs-property">Economy</span> === asset[<span class="hljs-string">'Country Name'</span>]
  );

  <span class="hljs-keyword">const</span> indicatorCodeMatch = [
    <span class="hljs-comment">// own land alone</span>
    <span class="hljs-string">'SG.OWN.LDAL.FE.ZS'</span>,
    <span class="hljs-string">'SG.OWN.LDAL.MA.ZS'</span>,
    <span class="hljs-comment">// own land jointly</span>
    <span class="hljs-string">'SG.OWN.LDJT.FE.ZS'</span>,
    <span class="hljs-string">'SG.OWN.LDJT.MA.ZS'</span>,
    <span class="hljs-comment">// own land both alone and jointly</span>
    <span class="hljs-string">'SG.OWN.LDAJ.FE.ZS'</span>,
    <span class="hljs-string">'SG.OWN.LDAJ.MA.ZS'</span>,
  ].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]);

  <span class="hljs-keyword">return</span> countryNameMatch &amp;&amp; indicatorCodeMatch;
})
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> isFemaleIndicator = [
      <span class="hljs-string">'SG.OWN.LDAL.FE.ZS'</span>,
      <span class="hljs-string">'SG.OWN.LDJT.FE.ZS'</span>,
      <span class="hljs-string">'SG.OWN.LDAJ.FE.ZS'</span>
    ].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]);

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">Sex</span> = isFemaleIndicator ? <span class="hljs-string">'Female'</span> : <span class="hljs-string">'Male'</span>;

    <span class="hljs-keyword">const</span> classification = economies_renamed.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span>
      c.<span class="hljs-property">Economy</span> === asset[<span class="hljs-string">'Country Name'</span>]
    );

    <span class="hljs-keyword">if</span> (classification) {
      <span class="hljs-keyword">return</span> {
        ...asset,
        <span class="hljs-title class_">Region</span>: classification.<span class="hljs-property">Region</span>,
        <span class="hljs-string">'Income group'</span>: classification[<span class="hljs-string">'Income group'</span>],
        <span class="hljs-title class_">Sex</span>
      };
    }

    <span class="hljs-keyword">return</span> { ...asset, <span class="hljs-title class_">Sex</span> };
});
</code></pre>
<div class="observablehq observablehq--block"><!--:2d5e1a96:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> own_land_filtered = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(
    <span class="hljs-comment">//Reduce the 'own_land' array to a key-value store with unique keys based on specific properties.</span>
    own_land.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">r, c</span>) =&gt;</span> {
      <span class="hljs-comment">// Create a unique key based on specific properties of the object.</span>
      <span class="hljs-keyword">const</span> key = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-string">"Country Name"</span>: c[<span class="hljs-string">"Country Name"</span>],
        <span class="hljs-string">"Country Code"</span>: c[<span class="hljs-string">"Country Code"</span>],
        <span class="hljs-string">"Year"</span>: c[<span class="hljs-string">"Year"</span>],
        <span class="hljs-string">"Region"</span>: c[<span class="hljs-string">"Region"</span>],
        <span class="hljs-string">"Income group"</span>: c[<span class="hljs-string">"Income group"</span>],
      });
      <span class="hljs-comment">// If the key does not exist in the result object, initialize it with specific properties and default values.</span>
      r[key] = r[key] || { ...c, <span class="hljs-string">"Female Value"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"Male Value"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"Indicator Name"</span>: <span class="hljs-string">"Own Land"</span> };
      <span class="hljs-comment">// Check if the current entry corresponds to Female or Male Value indicator and update values accordingly.</span>
      <span class="hljs-keyword">const</span> isFemaleIndicator = [
    <span class="hljs-comment">// own land alone</span>
    <span class="hljs-string">'SG.OWN.LDAL.FE.ZS'</span>,
    <span class="hljs-comment">// own land jointly</span>
    <span class="hljs-string">'SG.OWN.LDJT.FE.ZS'</span>,
    <span class="hljs-comment">// own land both alone and jointly</span>
    <span class="hljs-string">'SG.OWN.LDAJ.FE.ZS'</span>].<span class="hljs-title function_">includes</span>(c[<span class="hljs-string">"Indicator Code"</span>]);
      <span class="hljs-keyword">const</span> isMaleIndicator = [
    <span class="hljs-comment">// own land alone</span>
    <span class="hljs-string">'SG.OWN.LDAL.MA.ZS'</span>,
    <span class="hljs-comment">// own land jointly</span>
    <span class="hljs-string">'SG.OWN.LDJT.MA.ZS'</span>,
    <span class="hljs-comment">// own land both alone and jointly,</span>
    <span class="hljs-string">'SG.OWN.LDAJ.MA.ZS'</span>].<span class="hljs-title function_">includes</span>(c[<span class="hljs-string">"Indicator Code"</span>]);
      <span class="hljs-comment">// Update Female and Male Values based on the indicator type.</span>
      r[key][<span class="hljs-string">"Female Value"</span>] += isFemaleIndicator ? (<span class="hljs-built_in">isNaN</span>(c[<span class="hljs-string">"Value"</span>]) ? <span class="hljs-number">0</span> : c[<span class="hljs-string">"Value"</span>]) : <span class="hljs-number">0</span>;
      r[key][<span class="hljs-string">"Male Value"</span>] += isMaleIndicator ? (<span class="hljs-built_in">isNaN</span>(c[<span class="hljs-string">"Value"</span>]) ? <span class="hljs-number">0</span> : c[<span class="hljs-string">"Value"</span>]) : <span class="hljs-number">0</span>;

      <span class="hljs-keyword">return</span> r;
    }, {})
    <span class="hljs-comment">// Group the transformed data by unique keys (Country Name and Indicator Code)</span>
  ).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">groups, entry</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${entry[<span class="hljs-string">"Country Name"</span>]}</span>-<span class="hljs-subst">${entry[<span class="hljs-string">"Indicator Code"</span>]}</span>`</span>;
    <span class="hljs-comment">// If the key does not exist in the groups object, initialize it as an empty array.</span>
    groups[key] = groups[key] || [];
    <span class="hljs-comment">// Push the current entry into the corresponding group.</span>
    groups[key].<span class="hljs-title function_">push</span>(entry);
    <span class="hljs-keyword">return</span> groups;
  }, {})
  <span class="hljs-comment">//Extract the most recent data for Female and Male Values, filling missing Male Values with the last available value.</span>
).<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">group</span> =&gt;</span> {
  <span class="hljs-comment">// Find the most recent year in the current group.</span>
  <span class="hljs-keyword">const</span> mostRecentYear = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...group.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> entry[<span class="hljs-string">"Year"</span>]));
  <span class="hljs-keyword">let</span> lastMaleValue = <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">return</span> group
    <span class="hljs-comment">// Filter the entries for the most recent year and non-zero Female and Male Values.</span>
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> entry[<span class="hljs-string">"Year"</span>] === mostRecentYear &amp;&amp; entry[<span class="hljs-string">"Male Value"</span>] !== <span class="hljs-number">0</span> &amp;&amp; entry[<span class="hljs-string">"Female Value"</span>] !== <span class="hljs-number">0</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
      <span class="hljs-comment">// Fill missing Male Values with the last available value.</span>
      <span class="hljs-keyword">if</span> (entry[<span class="hljs-string">"Male Value"</span>] === <span class="hljs-number">0</span> &amp;&amp; lastMaleValue !== <span class="hljs-literal">null</span>) {
        entry[<span class="hljs-string">"Male Value"</span>] = lastMaleValue;
      } <span class="hljs-keyword">else</span> {
        lastMaleValue = entry[<span class="hljs-string">"Male Value"</span>];
      }
      <span class="hljs-keyword">return</span> entry;
    });
})
</code></pre>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:9a624d8a:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">plot</span>({
  <span class="hljs-attr">color</span>: { <span class="hljs-attr">legend</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">range</span>: [<span class="hljs-string">"dodgerblue"</span>, <span class="hljs-string">"magenta"</span>, <span class="hljs-string">"green"</span>, <span class="hljs-string">"purple"</span> , <span class="hljs-string">"orange"</span>, <span class="hljs-string">"red"</span>, <span class="hljs-string">"gray"</span>], opacity : <span class="hljs-number">0.8</span> },
  <span class="hljs-attr">insetTop</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">insetRight</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">insetBottom</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">insetLeft</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
  <span class="hljs-attr">width</span>: <span class="hljs-number">500</span>,
  <span class="hljs-attr">y</span>: { <span class="hljs-attr">percent</span>: <span class="hljs-literal">false</span>,<span class="hljs-attr">domain</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">80</span>], <span class="hljs-attr">grid</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">x</span>: { <span class="hljs-attr">percent</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">domain</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">80</span>], <span class="hljs-attr">grid</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">caption</span>: <span class="hljs-string">"Own Land"</span>,
  <span class="hljs-attr">marks</span>: [
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">dot</span>(own_land_filtered, {
      <span class="hljs-attr">x</span>: <span class="hljs-string">"Male Value"</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-string">"Female Value"</span>,
      <span class="hljs-attr">stroke</span>: <span class="hljs-string">"Region"</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"Region"</span>,
      <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.4</span>,
      <span class="hljs-attr">channels</span>: {<span class="hljs-title class_">Year</span>: <span class="hljs-string">"Year"</span>, <span class="hljs-title class_">Country</span>: <span class="hljs-string">"Country Name"</span>},
      <span class="hljs-attr">tip</span>: <span class="hljs-literal">true</span>
    }),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">ruleX</span>([<span class="hljs-number">0</span>]),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">ruleY</span>([<span class="hljs-number">0</span>]),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">link</span>([<span class="hljs-number">0</span>], {
      <span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">x2</span>: <span class="hljs-number">100</span>,
      <span class="hljs-attr">y2</span>: <span class="hljs-number">100</span>,
      <span class="hljs-attr">strokeDasharray</span>: <span class="hljs-string">"5,3"</span>,
      <span class="hljs-attr">strokeOpacity</span>: <span class="hljs-function">(<span class="hljs-params">k</span>) =&gt;</span> k === <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0.2</span>
    }),
  ],
})
</code></pre>
<hr>
<p>To bring everything together, let's quickly write out the remaining bits of code needed to create a stand-alone legend, then bundle it all up into a HTML component similar to match the World Bank's visualization:</p>
<div class="observablehq observablehq--block"><!--:b3635098:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> categories = [
            <span class="hljs-string">"Latin America &amp; Caribbean"</span>,
            <span class="hljs-string">"South Asia"</span>,     
            <span class="hljs-string">"Sub-Saharan Africa"</span>,
            <span class="hljs-string">"Europe &amp; Central Asia"</span>,
            <span class="hljs-string">"Middle East &amp; North Africa"</span>,
            <span class="hljs-string">"East Asia &amp; Pacific"</span>,
]
</code></pre>
<div class="observablehq observablehq--block"><!--:c85d582b:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> categoricalRange = [
 <span class="hljs-string">"rgba(0, 128, 0, 0.5)"</span>, <span class="hljs-string">"rgba(255, 165, 0, 0.5)"</span>, <span class="hljs-string">"rgba(255, 0, 0, 0.5)"</span>, <span class="hljs-string">"rgba(255, 0, 255, 0.5)"</span>, <span class="hljs-string">"rgba(128, 0, 128, 0.5)"</span>, <span class="hljs-string">"rgba(30, 144, 255, 0.5)"</span>
<span class="hljs-comment">//Green, Orange, Red, Magenta, Purple, Dodger Blue//</span>
]
</code></pre>
<hr>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:66c2b597:--></div>
<pre data-language="html"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1;"</span>&gt;</span>
    Men and women who own a house or land by sex
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">color-legend</span>
  <span class="hljs-attr">titleText</span>=<span class="hljs-string">""</span>
  <span class="hljs-attr">width</span>=<span class="hljs-string">"1200"</span>
  <span class="hljs-attr">height</span>=<span class="hljs-string">"22"</span>
  <span class="hljs-attr">scaletype</span>=<span class="hljs-string">"categorical"</span>
  <span class="hljs-attr">marktype</span>=<span class="hljs-string">"circle"</span>
  <span class="hljs-attr">domain</span>=<span class="hljs-string">'${JSON.stringify(categories)}'</span>
  <span class="hljs-attr">range</span>=<span class="hljs-string">'${JSON.stringify(categoricalRange)}'</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">color-legend</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${Plot.plot({
  color: { legend: false, range: ["dodgerblue", "magenta", "green", "purple" , "orange", "red", "gray"], opacity : 0.8 },
  insetTop: 10,
  insetRight: 10,
  insetBottom: 10,
  insetLeft: 10,
  height: 400,
  width: 500,
  y: { percent: false,domain:[0,100], grid: true },
  x: { percent: false, domain:[0,100], grid: true },
  caption: "Own House",
  marks: [
    Plot.dot(own_house_filtered, {
      x: "Male Value",
      y: "Female Value",
      stroke: "Region",
      fill: "Region",
      opacity: 0.4,
      channels: {Year: "Year", Country: "Country Name"},
      tip: true
    }),
    Plot.ruleX([0]),
    Plot.ruleY([0]),
    Plot.link([0], {
      x1: 0,
      y1: 0,
      x2: 100,
      y2: 100,
      strokeDasharray: "5,3",
      strokeOpacity: (k) =&gt; k === 1 ? 1 : 0.2
    }),
  ],
})}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${Plot.plot({
  color: { legend: false, range: ["dodgerblue", "magenta", "green", "purple" , "orange", "red", "gray"], opacity : 0.8 },
  insetTop: 10,
  insetRight: 10,
  insetBottom: 10,
  insetLeft: 10,
  height: 400,
  width: 500,
  y: { percent: false,domain:[0,80], grid: true },
  x: { percent: false, domain:[0,80], grid: true },
  caption: "Own Land",
  marks: [
    Plot.dot(own_land_filtered, {
      x: "Male Value",
      y: "Female Value",
      stroke: "Region",
      fill: "Region",
      opacity: 0.4,
      channels: {Year: "Year", Country: "Country Name"},
      tip: true
    }),
    Plot.ruleX([0]),
    Plot.ruleY([0]),
    Plot.link([0], {
      x1: 0,
      y1: 0,
      x2: 100,
      y2: 100,
      strokeDasharray: "5,3",
      strokeOpacity: (k) =&gt; k === 1 ? 1 : 0.2
    }),
  ],
})}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-family: Andes, Arial, sans-serif;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sub</span>&gt;</span>Source: <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://genderdata.worldbank.org/topics/assets"</span>&gt;</span>World Bank<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sub</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>

</code></pre>
<hr>
<p>And that's a wrap for this visualization.</p>
<hr>
<h3 id="law-grants-spouses-equal-administrative-authority-over-assets-during-marriage-%26-sons-and-daughters-have-equal-rights-to-inherit-assets-from-their-parents" tabindex="-1"><a class="observablehq-header-anchor" href="#law-grants-spouses-equal-administrative-authority-over-assets-during-marriage-%26-sons-and-daughters-have-equal-rights-to-inherit-assets-from-their-parents">Law grants spouses equal administrative authority over assets during marriage <br>&amp; Sons and daughters have equal rights to inherit assets from their parents</a></h3>
<p>The fourth and final visualization on the <a href="https://genderdata.worldbank.org/" target="_blank" rel="noopener noreferrer">Gender Data Portal</a>, <a href="https://genderdata.worldbank.org/topics/assets/" target="_blank" rel="noopener noreferrer">Assets topic page</a>, plots two different indicators next to one another as square marks with darker and lighter colors representing 'Yes' and 'No' values.  This topic examines the relative equality of men and women with respect to control over family assets.  Here's the target visualization:</p>
<div class="observablehq observablehq--block"><!--:0043ad4d:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:9c1c287e:--></div>
<p>We'll start by re-mapping the <a href="https://observablehq.com/d/7fb248de83bc0ad4#country_and_lending_group_classification_economies" target="_blank" rel="noopener noreferrer"><code>country_and_lending_group_classification_economies</code></a> dataset to create an index of country names that aligns with those in the source <code>assets</code> dataset.</p>
<div class="observablehq observablehq--block"><!--:3be46bfd:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> economies_name_map = (<span class="hljs-function">() =&gt;</span> country_and_lending_group_classification_economies.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">country</span>) =&gt;</span> {
  <span class="hljs-keyword">switch</span> (country) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"Côte d’Ivoire"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Cote d'Ivoire"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"Czech Republic"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Czechia"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"São Tomé and Príncipe"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Sao Tome and Principe"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"Türkiye"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Turkiye"</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> country;
  }
}))();
</code></pre>
<p>Next we'll filter the <a href="https://observablehq.com/d/7fb248de83bc0ad4#assets" target="_blank" rel="noopener noreferrer"><code>assets</code></a> dataset for our target indicators, <code>SG.LAW.ASST.AR</code> and <code>SG.IHT.ASST.PT.EQ</code>—equal inheritance rights for sons and daughters and equal authority over assets during marriage. For each filtered asset, we'll correct the country name using the mapping provided in <code>economies_name_map</code>, then search for the corresponding classification data in <code>country_and_lending_group_classifications</code>. If a classification is found, we'll add the 'Region' and 'Income group' properties, otherwise we'll set these properties to null. Finally, we will filtered again to exclude those objects with null 'Region' or 'Income group'. This ensures that only assets with complete classification information are included in our resulting <code>equal_authority_and_rights array</code>:</p>
<div class="observablehq observablehq--block"><!--:235da8fa:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> equal_authority_and_rights = assets
  <span class="hljs-comment">// Filter assets based on specific indicators</span>
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> [
    <span class="hljs-comment">// The law grants spouses equal administrative authority over assets during marriage (1=yes; 0=no)</span>
    <span class="hljs-string">'SG.LAW.ASST.AR'</span>,
    <span class="hljs-comment">// Sons and daughters have equal rights to inherit assets from their parents (1=yes; 0=no)</span>
    <span class="hljs-string">'SG.IHT.ASST.PT.EQ'</span>
  ].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]))
<span class="hljs-comment">// Process each filtered asset</span>
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
    <span class="hljs-comment">// Correct country name based on a mapping</span>
    <span class="hljs-keyword">const</span> correctedCountryName = economies_name_map.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span>
      entry.<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Country Name'</span>])
    );
    <span class="hljs-comment">// Find classification data based on the corrected country name</span>
    <span class="hljs-keyword">const</span> classification = country_and_lending_group_classifications.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span>
      c.<span class="hljs-property">Economy</span> === correctedCountryName
    );
    <span class="hljs-comment">// If classification data is found, add Region and Income group properties to the asset</span>
    <span class="hljs-keyword">if</span> (classification) {
      <span class="hljs-keyword">return</span> {
        ...asset,
        <span class="hljs-title class_">Region</span>: classification.<span class="hljs-property">Region</span>,
        <span class="hljs-string">'Income group'</span>: classification[<span class="hljs-string">'Income group'</span>],
      };
    }
    <span class="hljs-comment">// If no classification data is found, set Region and Income group properties to null</span>
    <span class="hljs-keyword">return</span> {
      ...asset,
      <span class="hljs-title class_">Region</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">'Income group'</span>: <span class="hljs-literal">null</span>,
    };
  })
  <span class="hljs-comment">// Filter out assets without complete classification information</span>
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> asset[<span class="hljs-string">'Region'</span>] !== <span class="hljs-literal">null</span> &amp;&amp; asset[<span class="hljs-string">'Income group'</span>] !== <span class="hljs-literal">null</span>);
</code></pre>
<p>Rendering the resulting array into a data table cell, we quickly see that we have data for several years—from 1970 to 2021.</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:502b1b52:--></div>
<p>Our target visualization focuses only on data from the most recent year.  Let's add one more filter to focus on observations from 2021:</p>
<div class="observablehq observablehq--block"><!--:61d00e74:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> equal_authority_and_rights_2021 = assets
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> [
    <span class="hljs-comment">// The law grants spouses equal administrative authority over assets during marriage (1=yes; 0=no)</span>
    <span class="hljs-string">'SG.LAW.ASST.AR'</span>,
    <span class="hljs-comment">// Sons and daughters have equal rights to inherit assets from their parents (1=yes; 0=no)</span>
    <span class="hljs-string">'SG.IHT.ASST.PT.EQ'</span>
  ].<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Indicator Code'</span>]) &amp;&amp; asset[<span class="hljs-string">'Year'</span>] === <span class="hljs-number">2021</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> correctedCountryName = economies_name_map.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span>
      entry.<span class="hljs-title function_">includes</span>(asset[<span class="hljs-string">'Country Name'</span>])
    );

    <span class="hljs-keyword">const</span> classification = country_and_lending_group_classifications.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span>
      c.<span class="hljs-property">Economy</span> === correctedCountryName
    );

    <span class="hljs-keyword">if</span> (classification) {
      <span class="hljs-keyword">return</span> {
        ...asset,
        <span class="hljs-title class_">Region</span>: classification.<span class="hljs-property">Region</span>,
        <span class="hljs-string">'Income group'</span>: classification[<span class="hljs-string">'Income group'</span>],
      };
    }

    <span class="hljs-keyword">return</span> {
      ...asset,
      <span class="hljs-title class_">Region</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">'Income group'</span>: <span class="hljs-literal">null</span>,
    };
  })
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> asset[<span class="hljs-string">'Region'</span>] !== <span class="hljs-literal">null</span> &amp;&amp; asset[<span class="hljs-string">'Income group'</span>] !== <span class="hljs-literal">null</span>);
</code></pre>
<p>Using a fairly simple plot, we can already come close to achieving our <a href="https://observablehq.com/d/7fb248de83bc0ad4#marriage_grants_equal_authority" target="_blank" rel="noopener noreferrer">target visualization</a>:</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:c56c1116:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">plot</span>({
  <span class="hljs-attr">color</span>: { <span class="hljs-attr">legend</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-comment">//marginRight: 160,</span>
  <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">inset</span>: <span class="hljs-number">12</span>,
  <span class="hljs-attr">marks</span>: [
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">frame</span>({ <span class="hljs-attr">strokeOpacity</span>: <span class="hljs-number">0.1</span> }),
    <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">dot</span>(
      equal_authority_and_rights_2021,
      <span class="hljs-title class_">Plot</span>.<span class="hljs-title function_">group</span>(
        { <span class="hljs-attr">r</span>: <span class="hljs-string">"count"</span> },
        {
          <span class="hljs-attr">fy</span>: <span class="hljs-string">"Region"</span>,
          <span class="hljs-attr">x</span>: <span class="hljs-string">"Country Name"</span>,
          <span class="hljs-attr">y</span>: <span class="hljs-string">"Indicator Code"</span>,
          <span class="hljs-attr">stroke</span>: <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"Indicator Code"</span>] === <span class="hljs-string">"SG.IHT.ASST.PT.EQ"</span>) {
              <span class="hljs-keyword">return</span> d.<span class="hljs-property">Value</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">"rgb(231, 173, 0)"</span> : <span class="hljs-string">"rgb(231, 219, 183)"</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"Indicator Code"</span>] === <span class="hljs-string">"SG.LAW.ASST.AR"</span>) {
              <span class="hljs-keyword">return</span> d.<span class="hljs-property">Value</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">"rgb(0, 86, 231)"</span> : <span class="hljs-string">"rgb(138, 161, 231)"</span>;
            }
          },
          <span class="hljs-attr">fill</span>: <span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"Indicator Code"</span>] === <span class="hljs-string">"SG.IHT.ASST.PT.EQ"</span>) {
              <span class="hljs-keyword">return</span> d.<span class="hljs-property">Value</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">"rgb(231, 173, 0)"</span> : <span class="hljs-string">"rgb(231, 219, 183)"</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"Indicator Code"</span>] === <span class="hljs-string">"SG.LAW.ASST.AR"</span>) {
              <span class="hljs-keyword">return</span> d.<span class="hljs-property">Value</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">"rgb(0, 86, 231)"</span> : <span class="hljs-string">"rgb(138, 161, 231)"</span>;
            }
          },
          <span class="hljs-attr">tip</span>: {
            <span class="hljs-attr">format</span>: {
              <span class="hljs-attr">fill</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">stroke</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">r</span>: <span class="hljs-literal">false</span>,
            },
          },
          <span class="hljs-attr">symbol</span>: <span class="hljs-string">"square"</span>,
        }
      )
    )
  ],
  <span class="hljs-attr">x</span>: { <span class="hljs-attr">axis</span>: <span class="hljs-literal">null</span> },
  <span class="hljs-attr">y</span>: { <span class="hljs-attr">axis</span>: <span class="hljs-literal">null</span> },
})
</code></pre>
<p>But of course we can go further! With just a bit more data wrangling and some CSS magic, we can reposition and wrap the facets.  Here it goes:</p>
<div class="observablehq observablehq--block"><!--:9a786a25:--></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> equal_authority_and_rights_2021_sorted = ((<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// Define an array of region names in a specific order.</span>
  <span class="hljs-keyword">const</span> regions = [
    <span class="hljs-string">"East Asia &amp; Pacific"</span>,
    <span class="hljs-string">"Europe &amp; Central Asia"</span>,
    <span class="hljs-string">"Latin America &amp; Caribbean"</span>,
    <span class="hljs-string">"Middle East &amp; North Africa"</span>,
    <span class="hljs-string">"South Asia"</span>,
    <span class="hljs-string">"Sub-Saharan Africa"</span>,
    <span class="hljs-string">"North America"</span>
  ];
  <span class="hljs-comment">// Use D3.js to group the input data by "Country Name".</span>
  <span class="hljs-comment">// Then sort the groups based on the index of their corresponding region in the defined regions array.</span>
  <span class="hljs-comment">// The sorting is done in descending order (-) of the region index.</span>
  <span class="hljs-comment">// Finally, format the sorted data as `${v[1].Value} / ${v[0].Value}`.</span>
  <span class="hljs-keyword">return</span> d3
    .<span class="hljs-title function_">sort</span>(
      <span class="hljs-comment">// Group the input data by "Country Name".</span>
      d3
        .<span class="hljs-title function_">group</span>(equal_authority_and_rights_2021, <span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> d[<span class="hljs-string">"Country Name"</span>])
        .<span class="hljs-title function_">values</span>(),
      <span class="hljs-comment">// Sort the groups based on the index of the region in the predefined regions array.</span>
      <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> -regions.<span class="hljs-title function_">indexOf</span>(v[<span class="hljs-number">0</span>].<span class="hljs-property">Region</span>),
      <span class="hljs-comment">// Format the sorted data as `${v[1].Value} / ${v[0].Value}`.</span>
      <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${v[<span class="hljs-number">1</span>].Value}</span> / <span class="hljs-subst">${v[<span class="hljs-number">0</span>].Value}</span>`</span>
    )
     <span class="hljs-comment">// Reverse the sorted array.</span>
    .<span class="hljs-title function_">reverse</span>()
    <span class="hljs-comment">// Flatten the array, removing nested arrays.</span>
    .<span class="hljs-title function_">flat</span>();
}))();
</code></pre>
<p>And now for the final visualization:</p>
<hr>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:36911c37:--></div>
<pre data-language="js"><code class="language-js">htl.<span class="hljs-property">html</span><span class="hljs-string">`
&lt;span style="font-family: Andes, Arial, sans-serif; font-size: 20px; font-weight: bold; line-height: 1;"&gt;
Law grants spouses equal administrative authority over assets during marriage; &lt;br/&gt;Sons and daughters have equal rights to inherit assets from their parents
&lt;/span&gt;
&lt;/p&gt;
&lt;div style="display: flex; flex-wrap: wrap; margin-left: 40px;"&gt;
<span class="hljs-subst">${d3
  .rollup(
    equal_authority_and_rights_2021_sorted,
    (v) =&gt;
      ((chart) =&gt; {
        d3.select(chart).on(<span class="hljs-string">"mouseenter"</span>, <span class="hljs-keyword">function</span> () {
          d3.select(<span class="hljs-variable language_">this</span>.parentElement).selectAll(<span class="hljs-string">"svg"</span>).style(<span class="hljs-string">"z-index"</span>, <span class="hljs-number">0</span>);
          d3.select(<span class="hljs-variable language_">this</span>).style(<span class="hljs-string">"z-index"</span>, <span class="hljs-number">1</span>); // <span class="hljs-keyword">for</span> the tooltip to be over the neighbors
        });
        <span class="hljs-keyword">return</span> chart;
      })(
        Plot.plot({
          style: <span class="hljs-string">"overflow: visible; background: transparent;"</span>,
          width: <span class="hljs-number">280</span>,
          height: <span class="hljs-number">100</span>,
          x: { axis: <span class="hljs-literal">null</span>, insetLeft: <span class="hljs-number">4</span>, insetRight: <span class="hljs-number">160</span>, domain: [<span class="hljs-number">0</span>, <span class="hljs-number">19</span>] },
          y: { reverse: <span class="hljs-literal">true</span>, axis: <span class="hljs-literal">null</span>, inset: <span class="hljs-number">3</span> },
          fy: {
            paddingInner: <span class="hljs-number">0</span>,
            axis: <span class="hljs-literal">null</span>,
            domain: [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>],
            insetBottom: <span class="hljs-number">20</span>
          },
          opacity: { range: [<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>] },
          color: { range: [<span class="hljs-string">"rgb(231, 173, 0)"</span>, <span class="hljs-string">"rgb(0, 86, 231)"</span>] },
          marks: [
            Plot.text([v[<span class="hljs-number">0</span>].Region], {
              frameAnchor: <span class="hljs-string">"bottom-left"</span>,
              fontSize: <span class="hljs-number">17</span>,
              facetAnchor: <span class="hljs-string">"top"</span>,
              dy: -<span class="hljs-number">4</span>
            }),
            Plot.dot(v, {
              x: (d, i) =&gt; <span class="hljs-built_in">Math</span>.floor((i % <span class="hljs-number">40</span>) / <span class="hljs-number">2</span>),
              fy: (d, i) =&gt; <span class="hljs-built_in">Math</span>.floor(i / <span class="hljs-number">40</span>),
              y: <span class="hljs-string">"Indicator Code"</span>,
              fill: <span class="hljs-string">"Indicator Code"</span>,
              fillOpacity: { value: <span class="hljs-string">"Value"</span>, scale: <span class="hljs-string">"opacity"</span> },
              symbol: <span class="hljs-string">"square"</span>,
              r: <span class="hljs-number">3</span>,
                            channels: {<span class="hljs-string">"Country"</span>: <span class="hljs-string">"Country Name"</span>,
                        <span class="hljs-string">"Equal Rights to Inherit"</span> : (d) =&gt; {
            <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"Indicator Code"</span>] === <span class="hljs-string">"SG.IHT.ASST.PT.EQ"</span>) {
              <span class="hljs-keyword">return</span> d.Value === <span class="hljs-number">1</span> ? <span class="hljs-string">"Yes"</span> : <span class="hljs-string">"No"</span>;
            }},
                        <span class="hljs-string">"Spouse Equal Authority"</span> : (d) =&gt; {
            <span class="hljs-keyword">if</span> (d[<span class="hljs-string">"Indicator Code"</span>] === <span class="hljs-string">"SG.LAW.ASST.AR"</span>) {
              <span class="hljs-keyword">return</span> d.Value === <span class="hljs-number">1</span> ? <span class="hljs-string">"Yes"</span> : <span class="hljs-string">"No"</span>;
            }

          },
                        },
              tip: {
                format: {
                  x: <span class="hljs-literal">false</span>,
                  fy: <span class="hljs-literal">false</span>,
                  fill: <span class="hljs-literal">false</span>,
                  fillOpacity: <span class="hljs-literal">false</span>,
                }
              }
            })
          ]
        })
      ),
    (d) =&gt; d.Region
  )
  .values()}</span>
&lt;/div&gt;
&lt;span style="font-family: Andes, Arial, sans-serif;"&gt;
    &lt;sub&gt;Source: &lt;a href="https://genderdata.worldbank.org/topics/assets"&gt;World Bank&lt;/a&gt;&lt;/sub&gt;
&lt;/span&gt;`</span>
</code></pre>
<hr>
<p>Ta-da! 🎉</p>
<hr>
<h2 id="acknowledgements" tabindex="-1"><a class="observablehq-header-anchor" href="#acknowledgements">Acknowledgements</a></h2>
<p>Thanks to <code>@fil</code> for all the time mentoring and for the fantastic Plot demonstrations. Thanks to <code>@mootarti</code> for answering my many questions on data wrangling and for the years of encouragement.
And thanks to <code>@pstuffa</code> for showing me many SQL equivalents to the JavaScript used in this notebook. 😊</p>
<hr>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-06-16T11:23:53">Jun 16, 2024</a>.</div>
</footer>
</div>
